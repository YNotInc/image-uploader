(this["webpackJsonpstore-tsx"]=this["webpackJsonpstore-tsx"]||[]).push([[0],{117:function(e,t,a){},118:function(e,t,a){},119:function(e,t,a){},120:function(e,t,a){},121:function(e,t,a){},122:function(e,t,a){},123:function(e,t,a){},124:function(e,t,a){},127:function(e,t,a){},128:function(e,t,a){},129:function(e,t,a){},133:function(e,t,a){a.r(t);var s=a(1),r=a.n(s),n=a(28),o=a.n(n),c=(a(70),a(22)),i=a(4),l=a.n(i),u=a(6),d=a(12),h=a(13),m=a(8),p=a(15),g=a(14),f=(a(72),a(10)),b=(a(73),a(74),a(5)),v=a(2),j=function(){return Object(v.jsx)(b.j,{color:"blue",className:"font-small pt-4 fixed-bottom",children:Object(v.jsx)("div",{className:"footer-copyright text-center py-3",children:Object(v.jsxs)(b.e,{fluid:!0,children:["\xa9 ",(new Date()).getFullYear()," Copyright: ",Object(v.jsx)("a",{href:"https://www.MDBootstrap.com",children:" MDBootstrap.com "})]})})})},x=a(20),O=a.n(x),k={register:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sending data to:","/api/user/register"),e.next=3,O()({method:"post",url:"/api/user/register",data:t});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),login:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("in login- Data:",t),e.next=3,O()({method:"post",url:"/api/user/login",data:t});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProducts:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return console.log("In API.getProducts",t),e.next=4,O.a.get(t,{headers:{Accept:"application/json,application/xml;q=0.9,*/*;q=0.8"}});case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProduct:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=14;break}return e.prev=1,console.log("in API.getProduct",t),e.next=5,O.a.get(t,{headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:s}});case 5:return r=e.sent,console.log("GET=",r),e.abrupt("return",r);case 10:return e.prev=10,e.t0=e.catch(1),console.log("User Unauthorized Error:",e.t0),e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,a,s){return e.apply(this,arguments)}}(),getUserInfo:function(){var e=Object(u.a)(l.a.mark((function e(t,a){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||!t){e.next=8;break}return e.next=3,O.a.get(t,a);case 3:return s=e.sent,console.log("APIGETUSERINFO: "+JSON.stringify(s)),e.abrupt("return",s);case 8:console.log("API.email:",a),console.log("API.baseURL:",t);case 10:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),refreshTokens:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n){var o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("API In RefreshToken: ",s),!t){e.next=6;break}return e.next=4,O()({method:"post",url:t,data:{email:r,expired:n},headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:s}});case 4:return o=e.sent,e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t,a,s,r,n){return e.apply(this,arguments)}}(),deleteProduct:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n){var o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return o={expired:r,email:n},console.log("DATA:",JSON.stringify(o)),console.log("API: GOING TO DELETE ROUTE: ".concat(t)),console.log("authtoken: ".concat(a,", refreshtoken: ").concat(s,", expired: ").concat(r,", email: ").concat(n,", URL: ").concat(t)),e.next=7,O.a.delete(t,{headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:s},data:o});case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t,a,s,r,n){return e.apply(this,arguments)}}(),updateProduct:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n,o,c,i){var u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=10;break}return console.log("in API.updateProduct, baseURL:",t),console.log("authToken:",a),console.log("refreshToken",s),console.log("API-updateProduct: name:",r,"value:",n,"expired:",c),u=[{propName:"name",value:r},{propName:"value",value:n},{propName:"expired",value:c},{propName:"email",value:i}],e.next=8,O.a.patch(t,u,{headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:s}});case 8:return d=e.sent,e.abrupt("return",d);case 10:case"end":return e.stop()}}),e)})));return function(t,a,s,r,n,o,c,i){return e.apply(this,arguments)}}(),insertCloudinary:function(){var e=Object(u.a)(l.a.mark((function e(t,a){var s,r,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=9;break}return console.log("In insertCloudinary",t),(s=new FormData()).append("file",a),r={headers:{"Content-Type":"multipart/form-data"}},e.next=7,O.a.post(t,s,r);case 7:return n=e.sent,e.abrupt("return",n);case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),insertProduct:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n,o,c,i,u){var d,h,m,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=i.cloudImageUrl,h=i.cloudImagePublicId,!t){e.next=10;break}return console.log("authToken:",r),console.log("refreshToken",n),m=[{propName:"name",value:o},{propName:"value",value:c},{propName:"productImage",value:d},{propName:"cloudId",value:h},{propName:"productId",value:a},{propName:"authToken",value:r},{propName:"refreshToken",value:n},{propName:"email",value:s},{propName:"expired",value:u}],e.next=8,O.a.post(t,m,{headers:{Authorization:r,"Content-Type":"application/json",refreshtoken:n}});case 8:return p=e.sent,e.abrupt("return",p);case 10:case"end":return e.stop()}}),e)})));return function(t,a,s,r,n,o,c,i,l){return e.apply(this,arguments)}}()},E=a(23),N=a.n(E),I=function(e){var t=localStorage.getItem(e);return console.log(e,":",t),t||""},S=function(){var e=localStorage.getItem("data"),t=!1;if(null!==e&&"undefined"!==typeof e){var a=N.a.utc(N()()).local().format("L LT"),s=JSON.parse(I("data")),r=N.a.utc(s.expiration).local().format("MM/DD/YYYY LT");console.log("currentTime.isAfter(sessionExpirationTime):",N()(a).isAfter(r)),console.log("sessionExpirationTime.isAfter(currentTime):",N()(r).isAfter(N()(a))),console.log("currentTime:",a,"sessionExpiration:",r);var n=N()(r).diff(N()(a),"minutes");console.log("TIMEDIFF:",n),t=n<=10}return t},T=function(e,t,a,s,r){var n,o,c={access_token:e,refresh_token:t,expiration:a,email:s,message:r};return console.log("created data",c.message),n="data",o=JSON.stringify(c),localStorage.setItem(n,o),console.log("set LocalStorage data",c.message),c},A=function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In getLocalStorage"),e.next=3,localStorage.getItem("data");case 3:return a=e.sent,console.log("curCredentials:",a),null!==a&&"undefined"!==typeof a?(s=JSON.parse(I("data")),console.log("CurCredObj",s),t=s):t={access_token:"",refresh_token:"",expiration:"",email:"",message:""},console.log("AuthenticationStore return curCredentials:",t),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){console.log("LOCAL STORAGE CLEARED"),localStorage.clear()},w=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/api/user/information/".concat(t),e.next=3,k.getUserInfo(a,t).then((function(e){var t={role:null===e||void 0===e?void 0:e.data.role};return t.role||(t.role="visitor"),t})).catch((function(e){console.log("ERROR: Setting ROLE to VISITOR:",e);return{role:"visitor"}}));case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R={visitor:{static:["products:hide","home-page:visit"]},user:{static:["products:view","products:details","products:hide","home-page:visit"]},admin:{static:["products:view","products:hide","products:update","products:insert","products:delete","products:details","users:get","users:getSelf","home-page:visit","dashboard-page:visit"]},writer:{static:["posts:list","posts:create","users:getSelf","home-page:visit","dashboard-page:visit"],dynamic:{"posts:edit":function(e,t){return!(!e||!t)&&e===t}}}},y=function(e){return function(e,t,a,s){console.log("CAN ROLE:","*"+t+"*");var r=e[t];if(!r)return console.log("NO PERMISSIONS"),!1;var n=r.static;if(n&&n.includes(a))return console.log("Data is static"),!0;var o=r.dynamic;if(o){console.log("Data is Dynamic");var c=o[a];return!!c&&c(s)}return!1}(R,e.role,e.perform,e.data)?e.yes():e.no()};y.defaultProps={yes:function(){return null},no:function(){return null}};var P=y;a(117);var L=function(){var e=window.location.pathname.split("/");return console.log("@@@URLARRAY:",e),e[e.length-1]};a(118);var U=function(e){console.log("USERBUTTON PROPS:",e);var t=e.activeIndex===e.buttonIndex&&e.activeName===e.name;return Object(v.jsx)(P,{role:e.userRole,perform:e.authorization,yes:function(){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(b.n,{onClick:e.captureEvent,children:Object(v.jsx)(b.o,{activeClassName:t?"activate":"de-activate",active:!1,name:e.name,to:e.route,children:e.label})})})},no:function(){return Object(v.jsx)(v.Fragment,{})}})},H=function(e){return Object(v.jsx)(b.o,{to:e.route,children:Object(v.jsx)(b.g,{name:e.name,onClick:e.captureEvent,children:e.name})})},D=function(e){return Object(v.jsx)(b.o,{to:e.route,children:Object(v.jsx)(b.g,{name:e.name,onClick:e.captureEvent,children:e.name})})},V=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var s;Object(d.a)(this,a),(s=t.call(this,e)).state=void 0,s.loggedOut=void 0,s.toggleCollapse=function(){s.setState({isOpen:!s.state.isOpen})};var r=(s.props,{userItems:[{name:"home",label:"Home",route:"/",authorization:"home-page:visit",key:0},{name:"products",label:"Products",route:"/products",authorization:"home-page:visit",key:1}],adminItem:[{name:"insert",route:"/product/insert",key:10}],loginItem:[{name:"registration",route:"/user/registration",key:20},{name:"login",route:"/user/login",key:21},{name:"logout",route:"#",key:22}]});return s.state={activeIndex:0,activeName:"",isOpen:!1,role:s.props.role,redirect:s.props.redirect,loggedOut:s.props.loggedOut,refreshPage:s.props.refreshPage,myNav:r,currentPage:"",homeLink:""},console.log("First STate ROLE:",s.props.role),console.log("myNavAll:",s.state.myNav),console.log("myNav userItems:",s.state.myNav.userItems),s.handleChangeActive=s.handleChangeActive.bind(Object(m.a)(s)),s}return Object(h.a)(a,[{key:"componentDidMount",value:function(){}},{key:"handleChangeActive",value:function(e,t,a){var s=this;this.props.handlePageClick(e);var r=e.target.name,n="home"===r||"products"===r;console.log("BUTTONEVENT:",e.target.name),console.log("ActiveIndex:",a),console.log("BUTTON:",t),console.log("BUTTONNAME",t.name),console.log("PageName:",L()),n&&this.setState({activeIndex:a,activeName:t.name},(function(){console.log("State BUTTONNAME:",s.state.activeName),console.log("State BUTTONIndex:",s.state.activeIndex)})),"logout"===e.target.name&&(this.props.setRole("visitor",!0),C())}},{key:"componentDidUpdate",value:function(){console.log("Navbar/index.js just update"),"Logout"===this.props.currentPage&&(C(),"visitor"===this.state.role||this.loggedOut||this.state.role!==this.props.role?this.state.role!==this.props.role&&"visitor"!==this.state.role&&(this.setState({role:"visitor"}),console.log("Navbar2: userRole =",this.state.role,"LoggedOut:",this.state.loggedOut),this.props.redirectHome()):(console.log("LOG USER OUT IN NAV"),console.log("Navbar1: userRole =",this.state.role,"LoggedOut:",this.state.loggedOut),this.props.setRole("visitor",!0)))}},{key:"render",value:function(){var e,t,a=this,s=this.state.role;console.log("NAVBAR CONTAINER: userRole =",s);var r=this.state.activeIndex;console.log("PropsCurrentPage: ",this.props.currentPage),console.log("PropsName: ",this.props.name);var n=this.props.loggedOut;this.props.role;return Object(v.jsxs)(b.p,{color:"default-color",expand:"md",className:"sticky-top z-depth-6",id:"main-header",children:[Object(v.jsx)("a",{className:"navbar-brand",href:"#",children:"Brand"}),Object(v.jsx)(b.r,{onClick:this.toggleCollapse,children:Object(v.jsx)("i",{className:"fas fa-bars"})}),Object(v.jsxs)(b.d,{id:"navbarCollapse3",isOpen:this.state.isOpen,navbar:!0,children:[Object(v.jsxs)(b.q,{left:!0,children:[null===(e=this.state.myNav.userItems)||void 0===e?void 0:e.map((function(e,t){return console.log("UserItems:",e),Object(v.jsx)(U,{activeIndex:r,activeName:e.name,buttonIndex:t,userRole:s,authorization:e.authorization,captureEvent:function(s){a.handleChangeActive(s,e,t)},name:e.name,route:e.route,label:e.label},e.key)})),Object(v.jsx)(P,{role:s,perform:"products:insert",yes:function(){var e;return Object(v.jsx)(v.Fragment,{children:n?"":Object(v.jsx)(b.n,{children:Object(v.jsxs)(b.f,{children:[Object(v.jsx)(b.i,{nav:!0,caret:!0,children:Object(v.jsx)("span",{className:"mr-2",children:"Admin"})}),Object(v.jsx)(b.h,{className:"dropdown-default",children:null===(e=a.state.myNav.adminItem)||void 0===e?void 0:e.map((function(e,t){return console.log("AdminItems:",e),Object(v.jsx)(H,{name:e.name,route:e.route,captureEvent:function(s){a.handleChangeActive(s,e,t)}},e.key)}))})]})})})},no:function(){return Object(v.jsx)(v.Fragment,{})}})]}),Object(v.jsxs)(b.q,{right:!0,children:[Object(v.jsx)(b.n,{children:Object(v.jsx)(b.o,{activeClassName:"not-active",className:"waves-effect waves-light",to:"#!",children:Object(v.jsx)(b.k,{fab:!0,icon:"twitter"})})}),Object(v.jsx)(b.n,{children:Object(v.jsx)(b.o,{activeClassName:"not-active",className:"waves-effect waves-light",to:"#!",children:Object(v.jsx)(b.k,{fab:!0,icon:"google-plus-g"})})}),Object(v.jsx)(b.n,{children:Object(v.jsxs)(b.f,{children:[Object(v.jsx)(b.i,{nav:!0,caret:!0,children:Object(v.jsx)(b.k,{icon:"user"})}),Object(v.jsx)(b.h,{className:"dropdown-default",right:!0,children:null===(t=this.state.myNav.loginItem)||void 0===t?void 0:t.map((function(e,t){return console.log("LoginItems:",e),Object(v.jsx)(D,{name:e.name,route:e.route,captureEvent:function(s){a.handleChangeActive(s,e,t)},setRole:a.props.setRole,role:a.props.role},e.key)}))})]})})]})]})]})}}]),a}(s.Component),M=a(17),_=Object(M.a)(),F=(a(119),function(){return Object(v.jsx)("header",{children:Object(v.jsx)("div",{className:"view jarallax","data-jarallax":'{"speed": 0.2}',children:Object(v.jsx)("div",{className:"container h-100 d-flex justify-content-center align-items-center",children:Object(v.jsx)("div",{className:"row pt-5 mt-3",children:Object(v.jsx)("div",{className:"col-md-12 mb-3",children:Object(v.jsxs)("div",{className:"intro-info-content text-center",children:[Object(v.jsxs)("h1",{className:"display-3 mb-5 wow fadeInDown","data-wow-delay":"0.3s",children:["NEW",Object(v.jsx)("a",{className:"indigo-text font-weight-bold",children:"COLLECTION"})]}),Object(v.jsx)("h5",{className:"text-uppercase mb-5 mt-1 font-weight-bold wow fadeInDown","data-wow-delay":"0.3s",children:"Free delivery & special prices"}),Object(v.jsx)("a",{className:"btn btn-outline-indigo btn-lg wow fadeInDown","data-wow-delay":"0.3s",children:"Shop"}),Object(v.jsx)("a",{className:"btn btn-indigo btn-lg wow fadeInDown","data-wow-delay":"0.3s",children:"Lookbook"})]})})})})})})}),z=function(){var e,t,a,s,r=L();if(console.log("PageName:",r),""===r||"home"===r)t="home",a="activate",null===(s=document.querySelector("[name=products]"))||void 0===s||s.setAttribute("class"," de-activate nav-link Ripple-parent");else if("products"===r){var n;t="products",a="activate",null===(n=document.querySelector("[name=home]"))||void 0===n||n.setAttribute("class"," de-activate nav-link Ripple-parent")}else{var o,c;null===(o=document.querySelector("[name=home]"))||void 0===o||o.setAttribute("class"," de-activate nav-link Ripple-parent"),null===(c=document.querySelector("[name=products]"))||void 0===c||c.setAttribute("class"," de-activate nav-link Ripple-parent")}null===(e=document.querySelector("[name=".concat(t,"]")))||void 0===e||e.setAttribute("class",a+" nav-link Ripple-parent")},B=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var s;return Object(d.a)(this,a),(s=t.call(this,e)).state=void 0,s.state={},s}return Object(h.a)(a,[{key:"componentDidMount",value:function(){z()}},{key:"onClick",value:function(){this.setState({collapse:!this.state.collapse})}},{key:"render",value:function(){return Object(v.jsx)(r.a.Fragment,{children:Object(v.jsx)(F,{})})}}]),a}(s.Component),G=a(21),W=function(e){return Object(v.jsxs)(r.a.Fragment,{children:[Object(v.jsx)("label",{htmlFor:e.label}),Object(v.jsxs)(b.u,{children:[Object(v.jsx)(b.c,{size:"auto",children:e.label}),Object(v.jsx)(b.c,{children:Object(v.jsx)("input",{type:"text",className:e.className,id:e.id,placeholder:e.placeholder,name:e.name,value:e.value,onChange:e.changeHandler})})]})]})},K=function(e){return Object(v.jsx)("main",{role:"main",className:"form-align flex-shrink-0",children:Object(v.jsx)(b.e,{children:Object(v.jsx)(b.u,{children:Object(v.jsx)(b.c,{size:"12",middle:!0,children:Object(v.jsxs)("form",{children:[Object(v.jsx)("h1",{className:"mt-5",children:"Login Form"}),Object(v.jsx)("br",{}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)(W,{htmlFor:"formGroupEmail",className:"form-control",id:"formGroupEmail",label:"Email",name:"email",value:e.email,changeHandler:e.changeHandler}),Object(v.jsx)(W,{htmlFor:"formGroupPassword",className:"form-control",id:"formGroupPassword",name:"password",label:"Password",value:e.password,changeHandler:e.changeHandler}),Object(v.jsx)("br",{}),Object(v.jsx)(b.u,{children:Object(v.jsxs)(b.c,{children:[Object(v.jsx)("label",{htmlFor:"formGroupPassword"}),Object(v.jsx)(b.b,{className:"mx-0",color:"blue-grey",onClick:e.clickHandler,children:"Submit"}),Object(v.jsx)("h3",{className:"mt-5",children:e.message?e.message:""}),Object(v.jsx)("h3",{className:"mt-5",children:e.token?e.token:""})]})})]})]})})})})})},q=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var s;return Object(d.a)(this,a),(s=t.call(this,e)).state=void 0,s.state={email:"",password:"",message:"",access_token:"",refresh_token:"",expiration:"",hasAccessTokenExpired:!1,isUserAuthorized:!1,authToken:"",token:""},s.changeHandler=s.changeHandler.bind(Object(m.a)(s)),s.clickHandler=s.clickHandler.bind(Object(m.a)(s)),s}return Object(h.a)(a,[{key:"changeHandler",value:function(e){e.preventDefault();var t=e.target,a=t.name,s=t.value;console.log("--NAME:",a),Object.keys(this.state).includes(a)&&this.setState(Object(G.a)({},a,s))}},{key:"clickHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,s=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),console.log("User Name: ".concat(this.state.email,", Password: ").concat(this.state.password)),a={email:this.state.email,password:this.state.password},function(e){console.log("IN LOGIN CALL"),k.login(e).then(function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,n,o,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=10;break}return a=t.data,r=a.message,n=a.access_token,o=a.refresh_token,c=a.expiration,i=a.email,s.setState({access_token:n,expiration:c,refresh_token:o,message:r,email:i}),console.log("RES:",t),e.next=6,T(n,o,c,i,r);case 6:return e.next=8,s.props.getRole();case 8:e.sent,s.props.history.push("/products");case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch(function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("LOGIN ERROR",t),s.setState({message:t.message});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}(a),this.setState({email:"",password:""});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateVariables",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n){var o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="Bearer "+t,console.log("Auth token",o),this.setState({authToken:o}),console.log("Refresh token",a),this.setState({refresh_token:a}),this.setState({email:r}),e.next=8,S();case 8:c=e.sent,console.log("Expired?",c),this.setState({hasAccessTokenExpired:c}),this.setState({isUserAuthorized:!0}),this.setState({message:n});case 13:case"end":return e.stop()}}),e,this)})));return function(t,a,s,r,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(v.jsx)(r.a.Fragment,{children:Object(v.jsx)(K,{changeHandler:this.changeHandler,clickHandler:this.clickHandler,email:this.state.email,password:this.state.password,message:this.state.message,token:this.state.token})})}}]),a}(s.Component),J=(a(120),function(e){return Object(v.jsx)(r.a.Fragment,{children:Object(v.jsx)("div",{className:"input-group img-select-btn",children:Object(v.jsx)("input",{type:e.imageType,className:"".concat(e.imageClassName," border"),id:e.submitBtnId,ref:e.imageSelectRef,"aria-describedby":"inputGroupFileAddon01",name:e.imageName,accept:e.fileTypes,onChange:function(t){e.selectImage(t,e.imageSelectRef,e.previewCanvasRef)}})})})}),Y=(a(121),function(e){var t=e.image,a=e.uploaderBorder,s=r.a.createRef(),n=r.a.createRef();return Object(v.jsxs)(r.a.Fragment,{children:[Object(v.jsx)(b.c,{size:"1",className:a}),Object(v.jsx)(b.c,{size:"4",children:Object(v.jsxs)("div",{className:"col-12 input-border",children:[Object(v.jsx)(b.u,{children:Object(v.jsx)("div",{className:"name-container name-container-border",children:Object(v.jsx)("div",{className:"preview",ref:n,children:Object(v.jsx)("p",{id:"file-msg"})})})}),Object(v.jsx)(b.u,{children:Object(v.jsx)(J,{imageName:t.imageName,imageClassName:t.className,imageType:t.type,submitBtnId:t.submitBtnId,imageSelectRef:s,previewCanvasRef:n,aria:"inputGroupFileAddon01",fileTypes:".png, .jpeg, .jpg",selectImage:e.selectImage})})]})})]})}),Z=(a(122),function(e){return console.log("PRODUCTINSERTINPUTS",e.image),console.log("PRODUCTINSERT FileTypes",e.image.fileTypes),Object(v.jsx)("main",{className:"form-align",children:Object(v.jsx)(b.e,{children:Object(v.jsx)(b.u,{children:Object(v.jsx)(b.c,{size:"12",middle:!0,children:Object(v.jsxs)("form",{onSubmit:e.insertClickHandler,children:[Object(v.jsx)("h1",{className:"mt-5",children:"Product Insert Form"}),Object(v.jsx)("br",{}),Object(v.jsxs)("div",{className:"product-name-value-form-group",children:[Object(v.jsx)(W,{htmlFor:"formGroupProductName",className:"form-control product-name",id:"formGroupProductName",placeholder:e.placeholderName,name:"productName",label:"Name",value:e.productName,changeHandler:e.changeHandler}),Object(v.jsx)(W,{htmlFor:"formGroupProductValue",className:"form-control product-value",id:"formGroupProductValue",placeholder:e.placeholderValue,name:"productValue",label:"Value",value:e.productValue,changeHandler:e.changeHandler}),Object(v.jsx)("br",{}),Object(v.jsx)(b.u,{className:"image-require-border",children:Object(v.jsxs)(b.c,{size:"12",children:["Image Requirements (PNG, JPG):",Object(v.jsx)("br",{}),Object(v.jsx)(b.c,{size:"7",children:Object(v.jsxs)("div",{className:"col-12",children:[Object(v.jsx)("b",{children:"Filesize:"})," < ",e.image.maxMB,"MB, ",Object(v.jsx)("b",{children:"Dimensions: "}),"Min: ",e.image.imageMin,", Max: ",e.image.imageMax]})})]})}),Object(v.jsxs)(b.u,{role:"main",className:"upload-image-form-group image-require-border",children:[Object(v.jsx)("br",{}),Object(v.jsx)(Y,{uploaderBorder:"uploader-border",image:e.image,submitImageHandler:e.submitImageHandler,productImage:e.productImage,selectImage:e.selectImage,setImageProp:e.setImageProp}),Object(v.jsxs)(b.c,{className:"image-require-border",children:[Object(v.jsx)("label",{htmlFor:"formGroupSubmitButton"}),Object(v.jsx)(b.b,{id:"submit-image",color:"blue-grey",type:"submit",children:"Submit"}),Object(v.jsx)("h3",{className:"mt-5",children:e.message?e.message:""})]})]})]})]})})})})})}),$={refresh:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n){var o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In REFRESHTOKENS:",s),e.next=3,k.refreshTokens(t,a,s,r,n);case 3:return o=e.sent,console.log("tokenStore: newCredentialResponse = ",o),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t,a,s,r,n){return e.apply(this,arguments)}}()},Q={setLocalCredWNewTokens:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n){var o,c,i,u,d,h,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("ProductListContainer refresh-token: ",t),e.prev=1,console.log("CredentialStore: Before TokenStore Call"),e.next=5,$.refresh(a,s,t,r,n);case 5:if(o=e.sent,console.log("CredentialStore: After TokenStore Call"),console.log("ProductionList:response returned",o),200!==(null===o||void 0===o?void 0:o.status)){e.next=20;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED RES:",o),e.next=12,T(o.data.access_token,o.data.refresh_token,o.data.expiration,o.data.email,o.data.message);case 12:return c=e.sent,i=c.access_token,u=c.refresh_token,d=c.expiration,h=c.email,m=c.message,console.log("After setlocalStorage"),e.abrupt("return",{access_token:i,refresh_token:u,expiration:d,email:h,message:m});case 20:e.next=29;break;case 22:if(e.prev=22,e.t0=e.catch(1),401!==e.t0.response.status){e.next=29;break}return console.log("401 status received in ProductUpdate"),e.next=28,C();case 28:return e.abrupt("return",{authToken:"",access_token:"",refresh_token:"",expiration:null,email:"",hasAccessTokenExpired:!1,isUserAuthorized:!1,message:e.t0.response.data.message});case 29:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,a,s,r,n){return e.apply(this,arguments)}}(),getEvaluatedCredentials:function(e){var t="Bearer "+e.access_token,a=S();return{access_token:e.access_token,refresh_token:e.refresh_token,expiration:e.expiration,email:e.email,message:e.message,hasAccessTokenExpired:a,authToken:t,isUserAuthorized:!0,refreshed:!1}}},X=function(e){var t=e.name,a="Name: ".concat(t),s=e.value,r="Price: $".concat(s),n=e.id,o=e.image;return console.log("in productLIst:",e),Object(v.jsx)("div",{className:"container-fluid text-center",children:Object(v.jsx)("div",{className:"row",children:Object(v.jsxs)("div",{className:"col",children:[Object(v.jsx)("br",{}),Object(v.jsx)("img",{src:o,alt:"product ".concat(n)}),Object(v.jsx)("p",{className:"mt-2",children:Object(v.jsx)("b",{children:t?a:""})}),Object(v.jsxs)("p",{children:[Object(v.jsx)("b",{children:s?r:""}),Object(v.jsx)("br",{})]}),Object(v.jsx)("hr",{})]})})})},ee=function(){var e=Object(u.a)(l.a.mark((function e(t,a,s){var r,n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.getProduct(t,a,s);case 2:return r=e.sent,n=r&&Object(c.a)({},r.data),console.log("@ProductDetails",n),o=Object(v.jsx)(X,{image:n.productImage,id:n._id,name:n.name,value:n.value},n._id),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),te=function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/api/products",e.prev=1,e.next=4,k.getProducts("/api/products");case 4:return t=e.sent,a=null===t||void 0===t?void 0:t.data.products,console.log("productStore:retrieveUpdatedProductList data =",a),e.abrupt("return",a);case 10:e.prev=10,e.t0=e.catch(1),console.log("ERROR",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}();function ae(e,t,a,s,r,n){return se.apply(this,arguments)}function se(){return(se=Object(u.a)(l.a.mark((function e(t,a,s,r,n,o){var c,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.length>6&&void 0!==i[6]?i[6]:null,i.length>7&&void 0!==i[7]?i[7]:null,i.length>8&&void 0!==i[8]?i[8]:null,console.log("IN DELETE PRODUCT CALL"),console.log("DATA URL: ".concat(t,", ATOKENT: ").concat(r,", RTOKEN: ").concat(n,", EXPIRED: ").concat(o,", EMAIL: ").concat(s)),e.next=7,k.deleteProduct(t,r,n,o,s);case 7:return c=e.sent,console.log("deleteProduct: ",c),e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var re=function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n,o,c,i){var u,d,h=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=h.length>8&&void 0!==h[8]?h[8]:null,console.log("ProductStore:IN UPDATE PRODUCT CALL","expired",o),e.next=4,k.updateProduct(t,r,n,c,i,u,o,s);case 4:return d=e.sent,e.abrupt("return",d);case 6:case"end":return e.stop()}}),e)})));return function(t,a,s,r,n,o,c,i){return e.apply(this,arguments)}}(),ne=function(){var e=Object(u.a)(l.a.mark((function e(t,a){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.insertCloudinary(t,a);case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();function oe(e,t,a){return ce.apply(this,arguments)}function ce(){return(ce=Object(u.a)(l.a.mark((function e(t,a,s){var r,n,o,c,i,u,d,h=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>3&&void 0!==h[3]?h[3]:null,n=h.length>4&&void 0!==h[4]?h[4]:null,o=h.length>5&&void 0!==h[5]?h[5]:null,c=h.length>6?h[6]:void 0,i=h.length>7?h[7]:void 0,u=h.length>8?h[8]:void 0,console.log("ProductStore: insertProduct: IN INSERT PRODUCT CALL"),console.log("ProductStore: insertProduct: Insert Product Image:",u),console.log("ProductStore: insertProduct: email:",s),e.next=11,k.insertProduct(t,a,s,r,n,c,i,u,o);case 11:return d=e.sent,e.abrupt("return",d);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,s,r,n,o,c,i,u,d,h,m,p,g,f,b,v=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:"",a=v.length>1?v[1]:void 0,s=v.length>2?v[2]:void 0,r=v.length>3?v[3]:void 0,n=v.length>4?v[4]:void 0,o=v.length>5&&void 0!==v[5]?v[5]:null,c=v.length>6&&void 0!==v[6]?v[6]:null,i=v.length>7&&void 0!==v[7]?v[7]:null,u=v.length>8?v[8]:void 0,d=v.length>9?v[9]:void 0,h="Request failed with status code 500",m="Product name and value exists",console.log("ProductStore: PerformDbAction:","email:",a),console.log("ProductUpdateContainer:refresh_token = ",r),e.prev=14,console.log("BEFORE UPDATE CALLED"),console.log("PerformDBAction Image:",i),e.next=19,d(u+t,t,a,s,r,n,o,c,i);case 19:if(p=e.sent,console.log("AFTER UPDATE CALLED"),console.log("RESPONSEMESSAGE ",JSON.stringify(p),"STATUS",p.status),200!==p.status&&201!==p.status){e.next=29;break}return e.next=25,te();case 25:return g=e.sent,console.log("retrievedUpdatedProductList:",g),f={message:"Action Completed",refresh_token:"norefresh",isUserAuthorized:!0,hasAccessTokenExpired:!1,productsList:g},e.abrupt("return",f);case 29:e.next=37;break;case 31:return e.prev=31,e.t0=e.catch(14),console.log("err:",e.t0.message),b={message:""},b=e.t0.message===h?{message:m}:{message:e.t0.message},e.abrupt("return",b);case 37:case"end":return e.stop()}}),e,null,[[14,31]])})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n,o,c,i,u,d){var h,m,p,g,f,b,v,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Start stageDBAction: performDBAction"),console.log("stageDBAction-email:",a),e.next=4,ie(t,a,i,c,u,s,r,n,o,d);case 4:return h=e.sent,console.log("PRODUCTINSERT: CONTAINER performDBAction dBActionResults:",h),"Action Completed"===(null===h||void 0===h?void 0:h.message)&&(s&&(m={placeholderName:s}),r&&(p={placeholderValue:r})),console.log("Passed performDBAction"),f=(g=h).message,b=g.isUserAuthorized,v=g.productsList,"Request failed with status code 401"===f&&(f="Please Login"),j=m&&p?{message:f,refreshToken:c,isUserAuthorized:b,expired:u,productsList:v,placeholderName:m?m.placeholderName:"",placeholderValue:p?p.placeholderValue:""}:{message:f,refreshToken:c,isUserAuthorized:b,hasAccessTokenExpired:u,productsList:v},console.log("STAGEDBACTION: productListData =",v),e.abrupt("return",j);case 13:case"end":return e.stop()}}),e)})));return function(t,a,s,r,n,o,c,i,l,u){return e.apply(this,arguments)}}(),ue=function(e,t,a,s,r,n,o){e=document.createTextNode("File Name: "+a+", File Size: "+s+", Width: "+r+", Height: "+n);var c=document.createElement("li");c.setAttribute("id","li-id"),c.appendChild(e);var i=document.createElement("ol");o.appendChild(i),i.appendChild(c),c.style.color=t,de("canvas",o)},de=function(e,t){if(t){var a=t.getElementsByTagName("".concat(e)),s=!!a.length;console.log("item Length",a.length),console.log("is item created",s),console.log("no item",a),s&&t.removeChild(a[0])}},he=function(e){e&&(e.getElementsByTagName("canvas").length>=1&&(de("canvas",e),de("ol",e)))},me=function(e,t){var a=document.getElementById(e);a&&(a.innerHTML=t)},pe=function(e){return ge(e[0].size)},ge=function(e){return e<1024?e+"bytes":e>=1024&&e<1048576?(e/1024).toFixed(1)+"KB":e>=1048576?(e/1048576).toFixed(1)+"MB":void 0},fe=function(e,t,a){e.onload=function(){t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,t.width/2-e.width/2,t.height/2-e.height/2),t.setAttribute("class","img-fluid"),a.prepend(t)}},be=function(e,t,a,s,r,n,o,c,i,l){var u=document.createTextNode("");e?(n=pe(o),ue(u,"black",r,n,i,l,c),me(t,a),document.getElementById("submit-image").disabled=!1):(console.log("****DIMENSIONS NOT VALID****"),document.getElementById("submit-image").disabled=!0,n=pe(o),ue(u,"red",r,n,i,l,c),me(t,s));return n},ve=function(e){return e?e.files:null},je=function(e,t,a,s,r,n){t<=a&&s<=a&&(console.log("NOT A Valid File: "),me(r,n),document.getElementById("submit-image").disabled=!0,console.log("IMAGE ERROR ONLOAD"));he(e),console.log("in imgONERROR")},xe=function(e,t,a){var s=a.getElementsByTagName("canvas"),r=document.createElement("canvas");console.log("DISPLAYIMAGE CANVASELEMENT:",s),t&&(0===s.length||de("canvas",a),fe(e,r,a))},Oe=function(e,t){return console.log("IMG",e,"BLOB",t),new Promise((function(a,s){e.src=URL.createObjectURL(t),e.onload=function(){var s={imageName:t.name,imageHeight:e.height,imageWidth:e.width,imageSize:t.size,imageSrc:e.src};a(s)},e.onerror=function(){s("rejected")}}))},ke=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In convertImageStart"),(a=new Image()).crossOrigin="Anonymous",e.abrupt("return",new Promise((function(e,r){console.log("URL1: ",t),a.src=t,console.log("URL2: ",t),a.onload=function(){var t=document.createElement("canvas");console.log("canvas width: ".concat(t.width)),t.width=a.width,t.height=a.height,console.log("IMGWIDTH:",a.width,"IMGHEIGHT:",a.height);var r=t.getContext("2d");console.log("canvas width: ".concat(t.width)),r.drawImage(a,t.width/2-a.width/2,t.height/2-a.height/2),s=t.toDataURL("image/jpg"),console.log("Images loaded helper.js resolved",typeof s),e(s)},a.onerror=function(e){r("image rejected in BASE64 Conversion:"+e)}})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ee=function(e,t){if(!e)return!1;console.log("FILEType :",e.type);for(var a=0;a<t.length;a++)if(e.type===t[a])return!0},Ne=(a(123),function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var s;return Object(d.a)(this,a),(s=t.call(this,e)).cloudinaryURL="/api/products/cloudinary/insert/",s.refreshURL="/api/user/login/refresh",s.baseURL="/api/products/product/insert/",s.message=function(){console.log("Message method called")},s.state={productId:"",productName:"",productValue:"",productImage:"",placeholderName:"",placeholderValue:"",productsList:[],authToken:"",refresh_token:"",email:"",hasAccessTokenExpired:!1,isUserAuthorized:!0,message:"",image:{base64Str:"",cloudImageUrl:"",cloudImagePublicId:"",input:"",file:"",submitBtnId:"image-input",fileTypes:["image/jpeg","image/jpg","image/png"],imageName:"",imageWidth:0,imageHeight:0,imageSize:0,imageSrc:"",imageMin:200,imageMax:450,maxMB:2,errorTag:"file-msg",invalidMsg:"Not a valid file.",unacceptedMsg:"File not accepted.",acceptedMsg:"File accepted.",fileMsgElement:"",previewCanvasElement:"",submitImageElement:"",className:"customFileInput",type:"file"}},s.changeHandler=s.changeHandler.bind(Object(m.a)(s)),s.insertClickHandler=s.insertClickHandler.bind(Object(m.a)(s)),s.insertProduct=oe.bind(Object(m.a)(s)),s.productImageClickHandler=s.productImageClickHandler.bind(Object(m.a)(s)),s.submitImageHandler=s.submitImageHandler.bind(Object(m.a)(s)),s.selectImage=s.selectImage.bind(Object(m.a)(s)),s.setImageProp=s.setImageProp.bind(Object(m.a)(s)),s.message=s.message.bind(Object(m.a)(s)),s}return Object(h.a)(a,[{key:"setElementRef",value:function(){this.setImageProp("fileMsgElement",document.getElementById(this.state.image.errorTag)),console.log("ImageUploaderStateMounted",this.state.image.imageMin)}},{key:"selectImage",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s){var r,n,o,c,i,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.persist(),console.log("EVENT:",t),console.log("IMGREF:",a,"; PVCanvasRef:",s),console.log("SELECTIMAGE imageSelectRef:",null===a||void 0===a?void 0:a.current,"previewCanvasRef:",null===s||void 0===s?void 0:s.current,"imageSelectRef1:",typeof a),r=null===s||void 0===s?void 0:s.current,n=null===a||void 0===a?void 0:a.current,this.setImageProp("previewCanvasElement",r),this.setImageProp("input",n),o=this.state.image,console.log("In Contanier: imagebtn:",o.submitBtnId,"file:",o.input,"file2",o.file),e.next=12,this.productImageClickHandler(t);case 12:if(this.setState({image:o}),console.log("FILE INPUT: ",this.state.image.input),this.setImageProp("file",this.state.image.file),!ve(o.input)||!Ee(o.file,o.fileTypes)){e.next=44;break}return i=o.input.files[0],c=new Image(),e.prev=18,e.next=21,Oe(c,i);case 21:u=e.sent,console.log("loadedImgResult",u),c.src=u.imageSrc.toString(),this.setImageProp("imageSrc",u.imageSrc),this.setImageProp("imageWidth",u.imageWidth),this.setImageProp("imageHeight",u.imageHeight),this.setImageProp("imageSize",u.imageSize),this.setImageProp("imageName",u.imageName),console.log("DISPLAYIMAGE PREVIEW CANVAS:",o.previewCanvasElement,"*","state:",this.state.image.previewCanvasElement),de("ol",o.previewCanvasElement),l=o.imageWidth,h=o.imageMin,m=o.imageHeight,p=o.imageMax,d=l>=h&&l<=p&&m>=h&&m<=p,console.log("AREDIMENSIONSVALID:",d),this.setImageProp("imageSize",be(d,o.errorTag,o.acceptedMsg,o.unacceptedMsg,o.imageName,o.imageSize,o.input.files,o.previewCanvasElement,o.imageWidth,o.imageHeight)),xe(c,d,o.previewCanvasElement),this.setState({image:o}),e.next=42;break;case 38:e.prev=38,e.t0=e.catch(18),console.log("failure ",e.t0),je(o.previewCanvasElement,o.imageWidth,o.imageMax,o.imageHeight,o.errorTag,o.invalidMsg);case 42:e.next=46;break;case 44:he(o.previewCanvasElement),me(o.errorTag,o.unacceptedMsg);case 46:case"end":return e.stop()}var l,h,m,p}),e,this,[[18,38]])})));return function(t,a,s){return e.apply(this,arguments)}}()},{key:"setImageProp",value:function(e,t){var a=this.state.image;console.log("setImageProp",a,"Key",e,"Value",t),a[e]=t,console.log("image: ",a),this.setState({image:a}),console.log("Key:",[e]),console.log("Value:",t),console.log("Image ".concat(e,":"),this.state.image[e])}},{key:"submitImageHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a){var s,r,n,o,c,i,u,d,h,m,p,g,f,b,v,j,x,O,k,E,N;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.persist(),console.log("IN SUBMITIMAGEHANDLER"),r=a.input,n=a.imageWidth,o=a.imageHeight,c=a.imageMin,i=a.imageMax,u=a.imageName,d=a.imageSize,h=a.maxMB,m=a.errorTag,p=a.acceptedMsg,g=a.unacceptedMsg,f=a.fileMsgElement,b=a.previewCanvasElement,v=a.imageSrc,this.setState({image:a}),!ve(r)){e.next=46;break}if(console.log("ActionHelper file selected"),j=!1,j=n>=c&&n<=i&&o>=c&&o<=i,console.log("FileName:",u),console.log("FileSize:",d),x=d.slice(-2).toLowerCase(),O=d.replace(/[^\d.-]/g,""),console.log("FILESIZE = "+O+", Unit = "+x),console.log("Max File Size:",h),"mb"===x?(console.log("max file size:",h,", actual file size:",O),j=O<=h):"kb"===x&&(j=O<=1e3*h),console.log("Is Input File Valid:",j),j){e.next=21;break}console.log("image not acceptable"),me(m,f?g:p),e.next=43;break;case 21:return console.log("Image is acceptable"),k=v,console.log("Call convertImageFromURLTOBase"),e.next=26,ke(k);case 26:return E=e.sent,console.log("***Base64StringImage: ".concat(typeof E)),console.log("Calling productStore.insertCloudinary"),e.next=31,ne(this.cloudinaryURL,E);case 31:N=e.sent,console.log("Converted Image: ",E),s=this.state.image,console.log("CLOUD URL:",null===N||void 0===N?void 0:N.data.url),s.cloudImageUrl=null===N||void 0===N?void 0:N.data.url,console.log("CLOUD IMAGEURL:",s.cloudImageUrl),s.cloudImagePublicId=null===N||void 0===N?void 0:N.data.public_id,console.log("public_id",s.cloudImagePublicId),s.base64Str=E,console.log("Image:",s),this.setState({image:s}),console.log("State image: ",this.state.image,"cloud image url",this.state.image.cloudImageUrl);case 43:return he(b),e.next=46,this.productImageClickHandler(t);case 46:console.log("SubmitImageHandler: file NOT selected");case 47:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"setStateVariables",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n){var o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="Bearer "+t,console.log("Auth token",o),this.setState({authToken:o}),console.log("Refresh token",a),this.setState({refresh_token:a}),this.setState({email:r}),e.next=8,S();case 8:c=e.sent,console.log("Expired?",c),this.setState({hasAccessTokenExpired:c}),this.setState({isUserAuthorized:!0}),this.setState({message:n});case 13:case"end":return e.stop()}}),e,this)})));return function(t,a,s,r,n){return e.apply(this,arguments)}}()},{key:"resetStateVariables",value:function(){this.setState({authToken:""}),this.setState({access_token:""}),this.setState({refresh_token:""}),this.setState({email:""}),this.setState({hasAccessTokenExpired:!1})}},{key:"componentDidMount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=e.location;if(this.setElementRef(),t.state){var a=t.state,s=a.name,r=a.value,n=this.state.image;n.imageName="Choose File",this.setState({placeholderName:s,placeholderValue:"$ ".concat(r),image:n})}}},{key:"changeHandler",value:function(e){e.preventDefault();var t=e.target,a=t.name,s=t.value;a&&"string"===typeof s&&this.setState(Object(G.a)({},a,s))}},{key:"insertClickHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,s,r,n,o,c,i,u,d,h,m,p,g,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log("PRODUCTINSERTCONTAINER: insertCLICKHANDLER CLICKED"),e.prev=2,a=this.state.productName,s=this.state.productValue,this.setState({productName:""}),this.setState({productValue:""}),this.setState({placeholderName:""}),this.setState({placeholderValue:""}),e.next=11,A();case 11:return r=e.sent,n=r.access_token,o=r.refresh_token,c=r.expiration,i=r.email,e.next=18,this.setStateVariables(n,o,c,i,this.state.message);case 18:if(console.log("hasAccessTokenExpired",this.state.hasAccessTokenExpired),!this.state.hasAccessTokenExpired){e.next=43;break}return console.log("ProductInsertContainer refresh-token: ",this.state.refresh_token),e.prev=21,e.next=24,Q.setLocalCredWNewTokens(this.state.refresh_token,this.refreshURL,this.state.authToken,this.state.email,this.state.hasAccessTokenExpired);case 24:u=e.sent,console.log("newCredentials STATUS",u),u?(console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED newCredentials:",u),d=u.access_token,h=u.refresh_token,m=u.expiration,p=u.email,g=u.message,console.log("ProductionInsert:response returned",u),this.setStateVariables(d,h,m,p,g),console.log("New AUTHTOKEN after Refresh:",this.state.authToken)):console.log("I NEVER MADE IT TO IF"),e.next=43;break;case 29:if(e.prev=29,e.t0=e.catch(21),console.log("ERRORED OUT IN Insert CATCH"),401!==e.t0.response.status){e.next=43;break}return console.log("401 status received in ProductInsert"),e.next=36,C();case 36:return e.next=38,this.resetStateVariables();case 38:console.log("err",e.t0.response),console.log("error status code",e.t0.response.status),this.setState({isUserAuthorized:!1}),console.log("isUserAuthorised = ",this.state.isUserAuthorized),this.setState({message:e.t0.response.data.message});case 43:if(console.log("AUTHORIZED?:",this.state.isUserAuthorized),!this.state.isUserAuthorized){e.next=55;break}return console.log("ProductInsertContainer:refresh_token = ",this.state.refresh_token),e.next=48,this.submitImageHandler(t,this.state.image);case 48:return console.log("In stage"),e.next=51,le(this.state.productId,this.state.email,a,s,this.state.image,this.baseURL,this.state.refresh_token,this.state.authToken,this.state.hasAccessTokenExpired,oe);case 51:f=e.sent,console.log("Out stage"),console.log("ProductInsertContainer:",f),this.setState(f);case 55:e.next=61;break;case 57:e.prev=57,e.t1=e.catch(2),console.log(e.t1),this.setState({message:e.t1});case 61:case"end":return e.stop()}}),e,this,[[2,57],[21,29]])})));return function(t){return e.apply(this,arguments)}}()},{key:"productImageClickHandler",value:function(e){e.persist();var t,a,s,r,n,o=document.getElementById(this.state.image.submitBtnId),c=document.querySelector("#img-select-label");(console.log("QUERY SELECTOR",null===c||void 0===c?void 0:c.innerHTML),console.log("Image Selector Element",o),o.labels&&o.files)&&(console.log("ELEMENT:",null===o||void 0===o?void 0:o.files),a=null===(r=t=null===o||void 0===o?void 0:o.labels[0])||void 0===r?void 0:r.textContent,s=null===o||void 0===o?void 0:o.files[0]);if(e.target||((n=this.state.image).imageName="No File Chosen",console.log("ELSE: IMAGENAME:",n.imageName),this.setState({image:n}),a=this.state.image.imageName,console.log("LabelElement:",t),console.log("LabelValue:",a)),s&&o.files){var i;console.log("IMG Select EVENT INFO",e.target);var l=null===o||void 0===o?void 0:o.files[0].name.toString(),u=null===(i=t)||void 0===i?void 0:i.textContent;console.log("PRODUCTIMAGECLICKHANDLER:",null===o||void 0===o?void 0:o.baseURI),console.log("LabelValue:",u),console.log("FILENAME:",l),(n=this.state.image).imageName=l,console.log("IF: IMAGENAME:",n.imageName),n.file=s,console.log("ProductImageClickHandler file:",this.state.image.file),this.setState({image:n}),console.log("ProductImageClickHandler Image Path:",s),console.log("ProductImageName:",this.state.image.imageName),u=this.state.image.imageName,console.log("labelElement:",t),console.log("labelValue:",u)}else(n=this.state.image).imageName="No File Chosen",console.log("ELSE: IMAGENAME:",n.imageName),this.setImageProp(n,n),a=this.state.imageName}},{key:"render",value:function(){if(this.state.image)return Object(v.jsx)(r.a.Fragment,{children:Object(v.jsx)(Z,{changeHandler:this.changeHandler,insertClickHandler:this.insertClickHandler,productImageName:this.state.image.imageName,productName:this.state.productName,productValue:this.state.productValue,productImage:this.state.productImage,placeholderName:this.state.placeholderName,placeholderValue:this.state.placeholderValue,message:this.state.message,image:this.state.image,submitImageHandler:this.submitImageHandler,selectImage:this.selectImage,setImageProp:this.setImageProp})})}}]),a}(s.Component)),Ie=(a(124),a(24));var Se=function(e){console.log("IMG Props:",e);var t=e.to.state,a=t.name,s=(t.value,e.loggedOut),r=e.userRole,n=Object(v.jsx)(Ie.a,{to:e.to,className:"view overlay zoom rounded",children:Object(v.jsx)("img",{className:"card-img-top image-rules img-fluid",src:e.productImage,alt:"product ".concat(e.id)})}),o=Object(v.jsx)("a",{className:"view overlay zoom rounded",href:"#",children:Object(v.jsx)("img",{className:"card-img-top image-rules img-fluid",src:e.productImage,alt:"product ".concat(e.id)})});return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)("div",{className:"card-wrapper inline-block",children:Object(v.jsxs)("div",{className:"card card-rotating",children:[Object(v.jsx)(P,{role:r,perform:"products:view",yes:function(){return Object(v.jsx)(v.Fragment,{children:s?o:n})},no:function(){return Object(v.jsx)(v.Fragment,{children:o})}}),Object(v.jsx)("a",{children:Object(v.jsx)("div",{className:"mask rgba-white-slight"})}),Object(v.jsx)("div",{className:"card-body card-body-cascade text-center",children:Object(v.jsx)("h4",{className:"card-title",children:Object(v.jsx)("strong",{children:a})})})]})})})},Te=function(e){return Object(v.jsx)(Se,{to:{pathname:"".concat(e.viewPath).concat(e.id),state:{name:e.name,value:e.value,id:e.id,userRole:e.userRole}},productImage:e.productImage,id:e.id,userRole:e.userRole,loggedOut:e.loggedOut})},Ae=function(e){var t=e.name,a=e.value,s=e.id,r=e.productImage.replace(/['"']+/g,""),n=e.role;console.log("PRODUCTLISTITEM-USERRole:",n);var o=e.loggedOut;return console.log("User loggedOut:",o," role:",n),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(Te,{productImage:r,id:s,userRole:n,loggedOut:o,value:a,name:t,viewPath:"/products/product/"})})},Ce=a(64),we=a(65),Re=(a(127),function(){return Object(v.jsx)(r.a.Fragment,{children:Object(v.jsx)("div",{className:"fas fa-spin center",children:Object(v.jsx)(Ce.a,{icon:we.a,size:"5x",color:"#3B5998"})})})}),ye=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var s;return Object(d.a)(this,a),(s=t.call(this,e)).baseURL="/api/products",s._productsListData=void 0,s.state=void 0,s._productsListData=[],s.state={productsList:[],productListData:[],access_token:"",authToken:"",refresh_token:"",expiration:"",email:"",hasAccessTokenExpired:!1,isUserAuthorized:!0,loading:!1,message:"",role:s.props.role,loggedOut:s.props.loggedOut},s}return Object(h.a)(a,[{key:"resetStateVariables",value:function(){this.setState({authToken:""}),this.setState({access_token:""}),this.setState({refresh_token:""}),this.setState({email:""}),this.setState({hasAccessTokenExpired:!1})}},{key:"componentDidMount",value:function(){this.returnProducts(this.baseURL),this.setState({refreshed:!1}),z()}},{key:"returnProducts",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.prev=1,e.next=4,k.getProducts(t);case 4:a=e.sent,console.log("**RES: 1rst",a),a&&(this.productsListData=a.data.products,this.setState({loading:!1})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"productsListData",get:function(){return this._productsListData},set:function(e){var t=this;A().then((function(e){t.setState(e)})),console.log("----Data",e),this._productsListData=e,this.setState({productsListData:this._productsListData})}},{key:"products",get:function(){var e,t=this;return null===(e=this.productsListData)||void 0===e?void 0:e.map((function(e){return console.log("ProductListContainer: Product:",e),Object(v.jsx)(Ae,{role:t.state.role,id:e._id,name:e.name,value:e.value,productImage:e.productImage,loggedOut:t.props.loggedOut},e._id)}))}},{key:"render",value:function(){if(!0===this.state.loading)return console.log("loading..."),Object(v.jsx)(Re,{});var e=this.state.role;return console.log("ProductListContainer: userRole =",e,"LoggedOut:",this.state.loggedOut),console.log("****Setting productListData in ProductsListContainer: Render-285:"),Object(v.jsx)(r.a.Fragment,{children:Object(v.jsx)("div",{className:"container-fluid text-center",children:Object(v.jsx)("div",{className:"row",children:Object(v.jsxs)("div",{className:"col",children:[Object(v.jsx)("br",{}),this.productsListData?this.products:""]})})})})}}]),a}(s.Component),Pe=function(e){var t=e.message,a="Request failed with status code 401"===t?"Please login":t;return Object(v.jsx)("main",{role:"main",className:"form-align flex-shrink-0",children:Object(v.jsx)(b.e,{children:Object(v.jsx)(b.u,{children:Object(v.jsx)(b.c,{size:"12",middle:!0,children:Object(v.jsxs)("form",{children:[Object(v.jsx)("h1",{className:"mt-5",children:"Product Update Form"}),Object(v.jsx)("br",{}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)(W,{htmlFor:"formGroupEmail",className:"form-control product-name",id:"formGroupName",placeholder:e.placeholderName,label:"Name",name:"productName",value:e.productName,changeHandler:e.changeHandler}),Object(v.jsx)(W,{htmlFor:"formGroupName",className:"form-control",id:"formGroupValue",placeholder:e.placeholderValue,name:"productValue",label:"Price",value:e.productValue,changeHandler:e.changeHandler}),Object(v.jsx)("br",{}),Object(v.jsx)(b.u,{children:Object(v.jsxs)(b.c,{children:[Object(v.jsx)("label",{htmlFor:"formGroupName"}),Object(v.jsx)(b.b,{className:"mx-0",color:"blue-grey",onClick:e.updateClickHandler,children:"Submit"}),Object(v.jsx)("h3",{className:"mt-5",children:a})]})})]})]})})})})})},Le=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var s;Object(d.a)(this,a),(s=t.call(this,e)).refreshURL=void 0,s.baseURL=void 0,s._productItemComponent=void 0,s.state=void 0;var r=e.location.state,n=null===r||void 0===r?void 0:r.name,o=null===r||void 0===r?void 0:r.value;return s.refreshURL="/user/login/refresh",s.baseURL="/api/products/product/update/",s.state={productItem:{},productId:"",productName:"",productValue:"",placeholderName:"",placeholderValue:"",authToken:"",refresh_token:"",email:"",hasAccessTokenExpired:!1,isUserAuthorized:!0,message:""},s.setState({productName:n}),s.setState({productValue:o}),s.changeHandler=s.changeHandler.bind(Object(m.a)(s)),s.updateClickHandler=s.updateClickHandler.bind(Object(m.a)(s)),s}return Object(h.a)(a,[{key:"productItemComponent",get:function(){return this._productItemComponent},set:function(e){this._productItemComponent=e,this.setState({productItem:this._productItemComponent})}},{key:"setStateVariables",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n){var o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="Bearer "+t,console.log("Auth token",o),this.setState({authToken:o}),console.log("Refresh token",a),this.setState({refresh_token:a}),this.setState({email:r}),e.next=8,S();case 8:c=e.sent,console.log("Expired?",c),this.setState({hasAccessTokenExpired:c}),this.setState({isUserAuthorized:!0}),this.setState({message:n});case 13:case"end":return e.stop()}}),e,this)})));return function(t,a,s,r,n){return e.apply(this,arguments)}}()},{key:"resetStateVariables",value:function(){this.setState({authToken:""}),this.setState({access_token:""}),this.setState({refresh_token:""}),this.setState({email:""}),this.setState({hasAccessTokenExpired:!1})}},{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,s,r,n,o,c,i,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z(),t=window.location.pathname,(a=t.split("/")).splice(3,1),a.splice(0,1,"/api"),a.splice(2,1),s=a.join("/"),e.t0=Q,e.next=10,A();case 10:if(e.t1=e.sent,r=e.t0.getEvaluatedCredentials.call(e.t0,e.t1),this.setState(r),console.log("AUTHTOKEN Set to LocalStorage:",this.state.authToken),console.log("hasAccessTokenExpired",this.state.hasAccessTokenExpired),!this.state.hasAccessTokenExpired){e.next=37;break}return e.prev=16,e.next=19,Q.setLocalCredWNewTokens(this.state.refresh_token,this.refreshURL,this.state.authToken,this.state.email,this.state.hasAccessTokenExpired);case 19:if(!(n=e.sent)){e.next=31;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED userCredentials:",n),e.t2=Q,e.next=25,A();case 25:e.t3=e.sent,o=e.t2.getEvaluatedCredentials.call(e.t2,e.t3),this.setState(o),console.log("New AUTHTOKEN after Refresh:",this.state.authToken),e.next=32;break;case 31:console.log("I NEVER MADE IT TO IF");case 32:e.next=37;break;case 34:e.prev=34,e.t4=e.catch(16),console.log("err: ",e.t4);case 37:if(console.log("ProductUpdateContainer AUTHORIZED?:",this.state.isUserAuthorized),!this.state.isUserAuthorized){e.next=44;break}return e.next=41,ee(s,this.state.authToken,this.state.refresh_token);case 41:this.productItemComponent=e.sent,c=this.productItemComponent.props,i=c.name,u=c.value,(d=c.id)&&i&&u&&this.setState({productId:d,placeholderName:i,placeholderValue:"$ ".concat(u)});case 44:case"end":return e.stop()}}),e,this,[[16,34]])})));return function(){return e.apply(this,arguments)}}()},{key:"changeHandler",value:function(e){e.preventDefault();var t=e.target,a=t.name,s=t.value;a&&"string"===typeof s&&this.setState(Object(G.a)({},a,s))}},{key:"stageDBAction",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,s,r,n){var o,c,i,u,d,h,m,p=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.length>5&&void 0!==p[5]?p[5]:null,o=p.length>6?p[6]:void 0,console.log("Start performDBAction"),console.log("hasExpired0:",this.state.hasAccessTokenExpired),e.next=6,ie(t,a,this.state.refresh_token,this.state.authToken,this.state.hasAccessTokenExpired,s,r,null,n,o);case 6:c=e.sent,console.log("hasExpired1:",this.state.hasAccessTokenExpired),"Action Completed"===(null===c||void 0===c?void 0:c.message)&&(s&&this.setState({placeholderName:s}),r&&this.setState({placeholderValue:r})),console.log("Passed performDBAction"),u=(i=c).message,d=i.refresh_token,h=i.isUserAuthorized,m=i.hasAccessTokenExpired,console.log("hasAccessTokenExpired2:",m),this.setState({message:u,refresh_token:d,isUserAuthorized:h,hasAccessTokenExpired:m});case 13:case"end":return e.stop()}}),e,this)})));return function(t,a,s,r,n){return e.apply(this,arguments)}}()},{key:"updateClickHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,s,r,n,o,c,i,u,d,h,m,p,g,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),a=this.state.productName,s=this.state.productValue,this.setState({productName:""}),this.setState({productValue:""}),this.setState({placeholderName:""}),this.setState({placeholderValue:""}),e.next=10,A();case 10:return r=e.sent,n=r.access_token,o=r.refresh_token,c=r.expiration,i=r.email,u=r.message,e.next=18,this.setStateVariables(n,o,c,i,u);case 18:if(console.log("HasAccessTokenExpired",this.state.hasAccessTokenExpired),!this.state.hasAccessTokenExpired){e.next=43;break}return console.log("ProductUpdateContainer refresh-token: ",this.state.refresh_token),e.prev=21,e.next=24,Q.setLocalCredWNewTokens(this.state.refresh_token,this.refreshURL,this.state.authToken,this.state.email,this.state.hasAccessTokenExpired);case 24:d=e.sent,console.log("newUserCredentials STATUS",d),d&&(console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED newUserCredentials:",d),h=d.access_token,m=d.refresh_token,p=d.expiration,g=d.email,f=d.message,console.log("ProductionUpdate:response returned",d),this.setStateVariables(h,m,p,g,f),console.log("New AUTHTOKEN after Refresh:",this.state.authToken)),e.next=43;break;case 29:if(e.prev=29,e.t0=e.catch(21),console.log("ERRORED OUT IN UPDATE CATCH"),401!==e.t0.response.status){e.next=43;break}return console.log("401 Unauthorized user"),e.next=36,C();case 36:return e.next=38,this.resetStateVariables();case 38:console.log("err",e.t0.response),console.log("error status code",e.t0.response.status),this.setState({isUserAuthorized:!1}),console.log("isUserAuthorised = ",this.state.isUserAuthorized),this.setState({message:"401 Unauthorized user"});case 43:if(console.log("AUTHORIZED?:",this.state.isUserAuthorized),!this.state.isUserAuthorized){e.next=48;break}return console.log("ProductUpdateContainer:refresh_token = ",this.state.refresh_token),e.next=48,this.stageDBAction(this.state.productId,i,a,s,this.baseURL,null,re);case 48:e.next=54;break;case 50:e.prev=50,e.t1=e.catch(0),console.log("User is logged out"),this.setState({message:"User is logged out"});case 54:case"end":return e.stop()}}),e,this,[[0,50],[21,29]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(v.jsx)(r.a.Fragment,{children:Object(v.jsx)(Pe,{changeHandler:this.changeHandler,updateClickHandler:this.updateClickHandler,productName:this.state.productName,productValue:this.state.productValue,placeholderName:this.state.placeholderName,placeholderValue:this.state.placeholderValue,message:this.state.message})})}}]),a}(s.Component);a(128);var Ue=function(e){return Object(v.jsx)(Ie.a,{to:e.to,children:Object(v.jsx)("button",{type:"button",className:"btn custom-btn",tabIndex:0,children:e.buttonName})})},He=function(e){return Object(v.jsx)(Ue,{to:{pathname:"".concat(e.path).concat(e.id)},buttonName:e.btnName})};a(129);var De=function(e){var t=e.id,a=e.id,s=e.btnClickHandler;return Object(v.jsx)("button",{type:"button",className:"btn custom-btn",tabIndex:0,onClick:function(e){s(e)},id:a,children:e.buttonName},t)},Ve=function(e){return Object(v.jsx)(De,{buttonName:e.btnName,id:e.id,btnClickHandler:e.btnClickHandler})},Me=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var s;return Object(d.a)(this,a),(s=t.call(this,e)).deleteURL="/api/products/product/delete/",s.refreshURL="/user/login/refresh",s._productItemComponent=void 0,s.state=void 0,s.deleteProduct=void 0,s._productsListData=void 0,console.log("ViewPROPS:",e),s._productsListData=[],s.state={productsList:[],productListData:[],productItem:{},baseUrl:"",access_token:"",authToken:"",refresh_token:"",expiration:"",email:"",hasAccessTokenExpired:!1,isUserAuthorized:!0,loading:!1,message:""},s.deleteProduct=ae.bind(Object(m.a)(s)),console.log("ViewContainer Props1:",s.props.role),s}return Object(h.a)(a,[{key:"productsListData",get:function(){return this._productsListData},set:function(e){var t=this;A().then((function(e){t.setState(e)})),console.log("----Data",e),this._productsListData=e}},{key:"deleteClickHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,s,r,n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),a=t.target.id,e.t0=Q,e.next=6,A();case 6:if(e.t1=e.sent,s=e.t0.getEvaluatedCredentials.call(e.t0,e.t1),this.setState(s),console.log("AUTHTOKEN Set to LocalStorage:",this.state.authToken),console.log("hasAccessTokenExpired",this.state.hasAccessTokenExpired),!this.state.hasAccessTokenExpired){e.next=33;break}return e.prev=12,e.next=15,Q.setLocalCredWNewTokens(this.state.refresh_token,this.refreshURL,this.state.authToken,this.state.email,this.state.hasAccessTokenExpired);case 15:if(!(r=e.sent)){e.next=27;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED userCredentials:",r),e.t2=Q,e.next=21,A();case 21:e.t3=e.sent,n=e.t2.getEvaluatedCredentials.call(e.t2,e.t3),this.setState(n),console.log("New AUTHTOKEN after Refresh:",this.state.authToken),e.next=28;break;case 27:console.log("I NEVER MADE IT TO IF");case 28:e.next=33;break;case 30:e.prev=30,e.t4=e.catch(12),console.log("err: ",e.t4);case 33:if(console.log("AUTHORIZED?:",this.state.isUserAuthorized),!this.state.isUserAuthorized){e.next=41;break}return console.log("EMAIL IN STAGEDBACTION:",this.state.email),e.next=38,le(a,this.state.email,null,null,null,this.deleteURL,this.state.refresh_token,this.state.authToken,this.state.hasAccessTokenExpired,this.deleteProduct);case 38:o=e.sent,this.setState(o),this.productsListData=this.state.productsList;case 41:e.next=48;break;case 43:e.prev=43,e.t5=e.catch(0),console.log("ERROR:",e.t5),console.log("User is logged out"),this.setState({message:"User is logged out"});case 48:this.props.history.push("/products");case 49:case"end":return e.stop()}}),e,this,[[0,43],[12,30]])})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,s,r,n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return z(),t=window.location.pathname,a=t.split("/"),console.log("@@@URLARRAY:",a),a.splice(0,1,"/api"),a.splice(2,1),s=a.join("/"),e.t0=Q,e.next=10,A();case 10:if(e.t1=e.sent,r=e.t0.getEvaluatedCredentials.call(e.t0,e.t1),this.setState(r),console.log("ProductViewContainer-AUTHTOKEN Set to LocalStorage:",this.state.authToken),console.log("ProductViewContainer- hasAccessTokenExpired:",this.state.hasAccessTokenExpired),!this.state.hasAccessTokenExpired){e.next=39;break}return e.prev=16,e.next=19,Q.setLocalCredWNewTokens(this.state.refresh_token,this.refreshURL,this.state.authToken,this.state.email,this.state.hasAccessTokenExpired);case 19:if(!(n=e.sent)){e.next=31;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED userCredentials:",n),e.t2=Q,e.next=25,A();case 25:e.t3=e.sent,o=e.t2.getEvaluatedCredentials.call(e.t2,e.t3),this.setState(o),console.log("New AUTHTOKEN after Refresh:",this.state.authToken),e.next=34;break;case 31:console.log("RefreshTokens invalid reset local credentials"),this.props.setRole("visitor",!0),C();case 34:e.next=39;break;case 36:e.prev=36,e.t4=e.catch(16),console.log("err: ",e.t4);case 39:if(console.log("ProductViewContainer AUTHORIZED?:",this.state.isUserAuthorized),!this.state.isUserAuthorized){e.next=46;break}return console.log("EMAIL IN STAGEDBACTION:",this.state.email),e.next=44,ee(s,this.state.authToken,this.state.refresh_token);case 44:this.productItemComponent=e.sent,console.log("PRODUCTVIEWCONTAINER-Product:",this.productItemComponent);case 46:console.log("ViewContainer Props2:",this.props.role),this.props.areCredentialsValid(),console.log("USER ACTIVE:",this.props.credentialsActive);case 49:case"end":return e.stop()}}),e,this,[[16,36]])})));return function(){return e.apply(this,arguments)}}()},{key:"productItemComponent",get:function(){return this._productItemComponent},set:function(e){this._productItemComponent=e,this.setState({productItem:this._productItemComponent})}},{key:"render",value:function(){var e=this,t=this.props.role,a=this.productItemComponent,s=null===a||void 0===a?void 0:a.props,n=this.props.loggedOut;return console.log("User loggedOut:",n," role:",t),Object(v.jsxs)(r.a.Fragment,{children:[a,Object(v.jsxs)("div",{className:"text-center",children:[n?"":Object(v.jsx)(P,{role:t,perform:"products:update",yes:function(){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(He,{id:null===s||void 0===s?void 0:s.id,name:"Update",value:null===s||void 0===s?void 0:s.value,path:"update/",btnName:"Update"})})},no:function(){return Object(v.jsx)(v.Fragment,{})}}),n?"":Object(v.jsx)(P,{role:t,perform:"products:delete",yes:function(){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(Ve,{btnName:"Delete",btnClickHandler:function(t){return e.deleteClickHandler(t)},id:null===s||void 0===s?void 0:s.id})})},no:function(){return Object(v.jsx)(v.Fragment,{})}})]})]})}}]),a}(s.Component),_e=function(e){return Object(v.jsx)("main",{role:"main",className:"form-align flex-shrink-0",children:Object(v.jsx)(b.e,{children:Object(v.jsx)(b.u,{children:Object(v.jsx)(b.c,{size:"12",middle:!0,children:Object(v.jsxs)("form",{children:[Object(v.jsx)("h1",{className:"mt-5",children:"Registration Form"}),Object(v.jsx)("br",{}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)(W,{htmlFor:"formGroupEmail",className:"form-control",id:"formGroupEmail",name:"email",label:"Email",value:e.email,changeHandler:e.changeHandler}),Object(v.jsx)(W,{htmlFor:"formGroupPassword",className:"form-control",id:"formGroupPassword",name:"password",label:"Password",value:e.password,changeHandler:e.changeHandler}),Object(v.jsx)("br",{}),Object(v.jsx)(b.u,{children:Object(v.jsxs)(b.c,{children:[Object(v.jsx)("label",{htmlFor:"formGroupPassword"}),Object(v.jsx)(b.b,{className:"mx-0",color:"blue-grey",onClick:e.clickHandler,children:"Submit"}),Object(v.jsx)("h3",{className:"mt-5",children:e.message?e.message:""})]})})]})]})})})})})},Fe=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(e){var s;return Object(d.a)(this,a),(s=t.call(this,e)).state=void 0,s.state={email:"",password:"",message:"",existingUserError:"Request failed with status code 409",existingUserMsg:"User exists"},s.changeHandler=s.changeHandler.bind(Object(m.a)(s)),s.clickHandler=s.clickHandler.bind(Object(m.a)(s)),s}return Object(h.a)(a,[{key:"changeHandler",value:function(e){e.preventDefault();var t=e.target,a=t.name,s=t.value;a&&"string"===typeof s&&this.setState(Object(G.a)({},a,s))}},{key:"clickHandler",value:function(e){var t=this;e.preventDefault(),console.log("User Name: ".concat(this.state.email,", Password: ").concat(this.state.password));!function(e){console.log("IN REGISTER CALL"),k.register(e).then((function(e){console.log("regResponse:",e),t.setState({message:e.data.message})})).catch((function(e){console.log("ERROR:",e,"Message:",e.message),e.message===t.state.existingUserError?t.setState({message:t.state.existingUserMsg}):t.setState({message:e.message})}))}({email:this.state.email,password:this.state.password}),this.setState({email:"",password:""})}},{key:"render",value:function(){return Object(v.jsx)(r.a.Fragment,{children:Object(v.jsx)(_e,{changeHandler:this.changeHandler,clickHandler:this.clickHandler,email:this.state.email,password:this.state.password,message:this.state.message})})}}]),a}(s.Component),ze=function(e){Object(p.a)(a,e);var t=Object(g.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).state={currentPage:"",name:"",role:"",loading:!1,redirect:!1,loggedOut:!1,credentialsValid:!1},e.handlePageClick=e.handlePageClick.bind(Object(m.a)(e)),e.redirectHome=e.redirectHome.bind(Object(m.a)(e)),e.getRole=e.getRole.bind(Object(m.a)(e)),e.setRole=e.setRole.bind(Object(m.a)(e)),e.areCredentialsValid=e.areCredentialsValid.bind(Object(m.a)(e)),e}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.getRole(),this.areCredentialsValid()}},{key:"setRole",value:function(e,t){this.setState({role:e,loggedOut:t})}},{key:"areCredentialsValid",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S();case 2:return t=e.sent,a=!t,this.setState({credentialsValid:a}),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRole",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,s,r=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:return t=e.sent,console.log("APPJS. LOCALSTATEOBJ:",t),console.log("EMAIL:",t.email),a=t.email,console.log("Navbar Mount3 Email:",a),this.setState({loading:!0}),e.next=10,w(a).then((function(e){return console.log("setUserRole:",e.role),r.setState({role:e.role}),r.setState({loading:!1}),console.log("AFTER WILLMOUNT LOAD user:",r.state.role),console.log("APPJS ROLE B4 Set:",r.state.role),r.setState({role:e.role}),console.log("APPJS STATE ROLE After Set:",r.state.role),e.role}));case 10:return s=e.sent,console.log("APP.JS ROLE:",s),this.setState({role:s,loggedOut:!1}),e.abrupt("return",s);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"redirectHome",value:function(){console.log("Called REDIRECT HOME redirect b4",this.state.redirect),this.setState({redirect:!0,role:"visitor",loggedOut:!0}),console.log("Called REDIRECT HOME redirect after",this.state.redirect),_.push({pathname:"/"})}},{key:"handlePageClick",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({currentPage:t.target.name,name:t.target.name}),"Logout"===t.target.name&&this.redirectHome();case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){console.log("APPJS JUST UPDATED!")}},{key:"render",value:function(){var e=this;return!0===this.state.loading?Object(v.jsx)(Re,{}):Object(v.jsxs)(f.b,{history:_,children:[Object(v.jsx)(V,{handlePageClick:this.handlePageClick,navItems:this.state.navItems,currentPage:this.state.currentPage,name:this.state.name,role:this.state.role,redirectHome:this.redirectHome,setRole:this.setRole,loggedOut:this.state.loggedOut,redirect:this.state.redirect}),Object(v.jsxs)(f.c,{children:[Object(v.jsx)(f.a,{exact:!0,path:"/",render:function(e){return Object(v.jsx)(B,Object(c.a)({},e))}}),Object(v.jsx)(f.a,{exact:!0,path:"/user/registration",component:Fe}),Object(v.jsx)(f.a,{exact:!0,path:"/user/login",render:function(t){return Object(v.jsx)(q,Object(c.a)(Object(c.a)({},t),{},{getRole:e.getRole,role:e.state.role}))}}),Object(v.jsx)(f.a,{exact:!0,path:"/products/product/update/:product_id",component:Le}),Object(v.jsx)(f.a,{exact:!0,path:"/product/insert",component:Ne}),Object(v.jsx)(f.a,{exact:!0,path:"/products/product/:product_id",render:function(t){return Object(v.jsx)(Me,Object(c.a)(Object(c.a)({},t),{},{role:e.state.role,loggedOut:e.state.loggedOut,areCredentialsValid:e.areCredentialsValid,credentialsActive:e.state.credentialsActive,setRole:e.setRole}))}}),Object(v.jsx)(f.a,{exact:!0,path:"/products/",render:function(t){return Object(v.jsx)(ye,Object(c.a)(Object(c.a)({},t),{},{role:e.state.role,loggedOut:e.state.loggedOut}))}})]}),Object(v.jsx)(j,{})]})}}]),a}(s.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(130),a(131),a(132);o.a.render(Object(v.jsx)(ze,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},70:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){}},[[133,1,2]]]);
//# sourceMappingURL=main.ab153f70.chunk.js.map