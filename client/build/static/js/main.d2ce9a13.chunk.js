(this["webpackJsonpstore-tsx"]=this["webpackJsonpstore-tsx"]||[]).push([[0],{117:function(e,t,a){},118:function(e,t,a){},119:function(e,t,a){},120:function(e,t,a){},121:function(e,t,a){},122:function(e,t,a){},123:function(e,t,a){},124:function(e,t,a){},127:function(e,t,a){},128:function(e,t,a){},129:function(e,t,a){},133:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a.n(r),s=a(28),o=a.n(s),c=(a(71),a(7)),i=a(4),l=a.n(i),u=a(6),d=a(14),g=a(15),m=a(9),h=a(17),p=a(16),f=a(10),b=(a(73),a(74),a(5)),v=a(2),j=function(){return Object(v.jsx)(b.j,{color:"blue",className:"font-small pt-4 fixed-bottom",children:Object(v.jsx)("div",{className:"footer-copyright text-center py-3",children:Object(v.jsxs)(b.e,{fluid:!0,children:["\xa9 ",(new Date).getFullYear()," Copyright: ",Object(v.jsx)("a",{href:"https://www.MDBootstrap.com",children:" MDBootstrap.com "})]})})})},x=a(21),O=a.n(x),k={register:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sending data to:","/api/user/register"),e.next=3,O()({method:"post",url:"/api/user/register",data:t});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),login:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("in login- Data:",t),e.next=3,O.a.post("/api/user/login",t);case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProducts:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return console.log("In API.getProducts",t),e.next=4,O.a.get(t,{headers:{Accept:"application/json,application/xml;q=0.9,*/*;q=0.8"}});case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),getProduct:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=16;break}return e.prev=1,console.log("in API.getProduct",t),console.log("authToken:",a),console.log("refreshToken",r),e.next=7,O.a.get(t,{headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:r}});case 7:return n=e.sent,console.log("GET=",n),e.abrupt("return",n);case 12:return e.prev=12,e.t0=e.catch(1),console.log("Get Product Unauthorized Error:",e.t0),e.abrupt("return",e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,a,r){return e.apply(this,arguments)}}(),getUserInfo:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t){e.next=9;break}return e.next=4,O.a.get(t,{headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:r}});case 4:return n=e.sent,console.log("APIGETUSERINFO: "+JSON.stringify(n)),e.abrupt("return",n);case 9:console.log("API.baseURL:",t);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(0),console.log("UserInfo Unauthorized Error:",e.t0),e.abrupt("return",e.t0);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,a,r){return e.apply(this,arguments)}}(),refreshTokens:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s){var o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("API In URL: ",t),console.log("API In AccessToken: ",a),console.log("API In RefreshToken: ",r),console.log("API In Email: ",n),!t){e.next=9;break}return e.next=7,O()({method:"post",url:t,data:{email:n,expired:s},headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:r}});case 7:return o=e.sent,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(t,a,r,n,s){return e.apply(this,arguments)}}(),deleteProduct:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s){var o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return o={expired:n,email:s},console.log("DATA:",JSON.stringify(o)),console.log("API: GOING TO DELETE ROUTE: ".concat(t)),console.log("authtoken: ".concat(a,", refreshtoken: ").concat(r,", expired: ").concat(n,", email: ").concat(s,", URL: ").concat(t)),e.next=7,O.a.delete(t,{headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:r},data:o});case 7:return c=e.sent,e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t,a,r,n,s){return e.apply(this,arguments)}}(),updateProduct:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s,o,c,i){var u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=10;break}return console.log("in API.updateProduct, baseURL:",t),console.log("authToken:",a),console.log("refreshToken",r),console.log("API-updateProduct: name:",n,"value:",s,"expired:",c),u=[{propName:"name",value:n},{propName:"value",value:s},{propName:"expired",value:c},{propName:"email",value:i}],e.next=8,O.a.patch(t,u,{headers:{Authorization:a,"Content-Type":"application/json",refreshtoken:r}});case 8:return d=e.sent,e.abrupt("return",d);case 10:case"end":return e.stop()}}),e)})));return function(t,a,r,n,s,o,c,i){return e.apply(this,arguments)}}(),insertCloudinary:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n){var s,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=10;break}return console.log("In insertCloudinary",t),(s=new FormData).append("file",a),o={headers:{Authorization:r,"Content-Type":"multipart/form-data",refreshtoken:n}},console.log("Cloudinary: ".concat(JSON.stringify(o),"; FormData: ").concat(JSON.stringify(s))),e.next=8,O.a.post(t,s,o);case 8:return c=e.sent,e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})));return function(t,a,r,n){return e.apply(this,arguments)}}(),insertProduct:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s,o,c,i,u){var d,g,m,h,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=i.cloudImageUrl,g=i.cloudImagePublicId,!t){e.next=12;break}return console.log("authToken:",n),console.log("refreshToken",s),m=[{propName:"name",value:o},{propName:"value",value:c},{propName:"productImage",value:d},{propName:"cloudId",value:g},{propName:"productId",value:a},{propName:"authToken",value:n},{propName:"refreshToken",value:s},{propName:"email",value:r},{propName:"expired",value:u}],h={headers:{Authorization:n,"Content-Type":"application/json",refreshtoken:s}},console.log("Insert Product DATA: ".concat(JSON.stringify(m),"; headers: ").concat(JSON.stringify(h))),e.next=10,O.a.post(t,m,h);case 10:return p=e.sent,e.abrupt("return",p);case 12:case"end":return e.stop()}}),e)})));return function(t,a,r,n,s,o,c,i,l){return e.apply(this,arguments)}}()},E=a(22),N=a.n(E),I=function(e){var t=localStorage.getItem(e);return console.log(e,":",t),t||""},S=function(){var e=localStorage.getItem("data"),t=!1;if(null!==e&&"undefined"!==typeof e){var a=N.a.utc(N()()).local().format("L LT"),r=JSON.parse(I("data")),n=N.a.utc(r.expiration).local().format("MM/DD/YYYY LT");console.log("currentTime.isAfter(sessionExpirationTime):",N()(a).isAfter(n)),console.log("sessionExpirationTime.isAfter(currentTime):",N()(n).isAfter(N()(a))),console.log("currentTime:",a,"sessionExpiration:",n);var s=N()(n).diff(N()(a),"minutes");console.log("TIMEDIFF:",s),t=s<=10}return t},T=function(e,t,a,r,n){var s,o,c={access_token:e,refresh_token:t,expiration:a,email:r,message:n};return console.log("created data",c.message),s="data",o=JSON.stringify(c),localStorage.setItem(s,o),console.log("set LocalStorage data",c.message),c},A=function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In getLocalStorage"),e.next=3,localStorage.getItem("data");case 3:return a=e.sent,console.log("curCredentials:",a),null!==a&&"undefined"!==typeof a?(r=JSON.parse(I("data")),console.log("CurCredObj",r),t=r):t={access_token:"",refresh_token:"",expiration:"",email:"",message:""},console.log("AuthenticationStore return curCredentials:",t),e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){console.log("LOCAL STORAGE CLEARED"),localStorage.clear()},w=function(){var e=Object(u.a)(l.a.mark((function e(t,a,r){var n,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/api/user/information/".concat(t),e.next=3,k.getUserInfo(n,a,r).then((function(e){var t={role:null===e||void 0===e?void 0:e.data.role};return t.role||(t.role="visitor"),t})).catch((function(e){console.log("ERROR: Setting ROLE to VISITOR:",e);return{role:"visitor"}}));case 3:return s=e.sent,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),y={visitor:{static:["products:hide","home-page:visit"]},user:{static:["products:view","products:details","products:hide","home-page:visit"]},admin:{static:["products:view","products:hide","products:update","products:insert","products:delete","products:details","users:get","users:getSelf","home-page:visit","dashboard-page:visit"]},writer:{static:["posts:list","posts:create","users:getSelf","home-page:visit","dashboard-page:visit"],dynamic:{"posts:edit":function(e,t){return!(!e||!t)&&e===t}}}},R=function(e){return function(e,t,a,r){console.log("CAN ROLE:","*"+t+"*");var n=e[t];if(!n)return console.log("NO PERMISSIONS"),!1;var s=n.static;if(s&&s.includes(a))return console.log("Data is static"),!0;var o=n.dynamic;if(o){console.log("Data is Dynamic");var c=o[a];return!!c&&c(r)}return!1}(y,e.role,e.perform,e.data)?e.yes():e.no()};R.defaultProps={yes:function(){return null},no:function(){return null}};var P=R;a(117);var U=function(){var e=window.location.pathname.split("/");return console.log("@@@URLARRAY:",e),e[e.length-1]};a(118);var L=function(e){console.log("USERBUTTON PROPS:",e);var t=e.activeIndex===e.buttonIndex&&e.activeName===e.name;return Object(v.jsx)(P,{role:e.userRole,perform:e.authorization,yes:function(){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(b.n,{onClick:e.captureEvent,children:Object(v.jsx)(b.o,{activeClassName:t?"activate":"de-activate",active:!1,name:e.name,to:e.route,children:e.label})})})},no:function(){return Object(v.jsx)(v.Fragment,{})}})},H=function(e){return Object(v.jsx)(b.o,{to:e.route,children:Object(v.jsx)(b.g,{name:e.name,onClick:e.captureEvent,children:e.name})})},D=function(e){return Object(v.jsx)(b.o,{to:e.route,children:Object(v.jsx)(b.g,{name:e.name,onClick:e.captureEvent,children:e.name})})},F=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var r;Object(d.a)(this,a),(r=t.call(this,e)).state=void 0,r.loggedOut=void 0,r.toggleCollapse=function(){r.setState({isOpen:!r.state.isOpen})};var n=(r.props,{userItems:[{name:"home",label:"Home",route:"/",authorization:"home-page:visit",key:0},{name:"products",label:"Products",route:"/products",authorization:"home-page:visit",key:1}],adminItem:[{name:"insert",route:"/product/insert",key:10}],loginItem:[{name:"registration",route:"/user/registration",key:20},{name:"login",route:"/user/login",key:21},{name:"logout",route:"#",key:22}]});return r.state={activeIndex:0,activeName:"",isOpen:!1,role:r.props.role,redirect:r.props.redirect,loggedOut:r.props.loggedOut,refreshPage:r.props.refreshPage,myNav:n,currentPage:"",homeLink:""},console.log("First STate ROLE:",r.props.role),console.log("myNavAll:",r.state.myNav),console.log("myNav userItems:",r.state.myNav.userItems),r.handleChangeActive=r.handleChangeActive.bind(Object(m.a)(r)),r}return Object(g.a)(a,[{key:"componentDidMount",value:function(){}},{key:"handleChangeActive",value:function(e,t,a){var r=this;this.props.handlePageClick(e);var n=e.target.name,s="home"===n||"products"===n;console.log("BUTTONEVENT:",e.target.name),console.log("ActiveIndex:",a),console.log("BUTTON:",t),console.log("BUTTONNAME",t.name),console.log("PageName:",U()),s&&this.setState({activeIndex:a,activeName:t.name},(function(){console.log("State BUTTONNAME:",r.state.activeName),console.log("State BUTTONIndex:",r.state.activeIndex)})),"logout"===e.target.name&&(this.props.setRole("visitor",!0),C())}},{key:"componentDidUpdate",value:function(){console.log("Navbar/index.js just update"),"Logout"===this.props.currentPage&&(C(),"visitor"===this.state.role||this.loggedOut||this.state.role!==this.props.role?this.state.role!==this.props.role&&"visitor"!==this.state.role&&(this.setState({role:"visitor"}),console.log("Navbar2: userRole =",this.state.role,"LoggedOut:",this.state.loggedOut),this.props.redirectHome()):(console.log("LOG USER OUT IN NAV"),console.log("Navbar1: userRole =",this.state.role,"LoggedOut:",this.state.loggedOut),this.props.setRole("visitor",!0)))}},{key:"render",value:function(){var e,t,a=this,r=this.state.role;console.log("NAVBAR CONTAINER: userRole =",r);var n=this.state.activeIndex;console.log("PropsCurrentPage: ",this.props.currentPage),console.log("PropsName: ",this.props.name);var s=this.props.loggedOut;return Object(v.jsxs)(b.p,{color:"default-color",expand:"md",className:"sticky-top z-depth-6",id:"main-header",children:[Object(v.jsx)("a",{className:"navbar-brand",href:"#!",children:"Brand"}),Object(v.jsx)(b.r,{onClick:this.toggleCollapse,children:Object(v.jsx)("i",{className:"fas fa-bars"})}),Object(v.jsxs)(b.d,{id:"navbarCollapse3",isOpen:this.state.isOpen,navbar:!0,children:[Object(v.jsxs)(b.q,{left:!0,children:[null===(e=this.state.myNav.userItems)||void 0===e?void 0:e.map((function(e,t){return console.log("UserItems:",e),Object(v.jsx)(L,{activeIndex:n,activeName:e.name,buttonIndex:t,userRole:r,authorization:e.authorization,captureEvent:function(r){a.handleChangeActive(r,e,t)},name:e.name,route:e.route,label:e.label},e.key)})),Object(v.jsx)(P,{role:r,perform:"products:insert",yes:function(){var e;return Object(v.jsx)(v.Fragment,{children:s?"":Object(v.jsx)(b.n,{children:Object(v.jsxs)(b.f,{children:[Object(v.jsx)(b.i,{nav:!0,caret:!0,children:Object(v.jsx)("span",{className:"mr-2",children:"Admin"})}),Object(v.jsx)(b.h,{className:"dropdown-default",children:null===(e=a.state.myNav.adminItem)||void 0===e?void 0:e.map((function(e,t){return console.log("AdminItems:",e),Object(v.jsx)(H,{name:e.name,route:e.route,captureEvent:function(r){a.handleChangeActive(r,e,t)}},e.key)}))})]})})})},no:function(){return Object(v.jsx)(v.Fragment,{})}})]}),Object(v.jsxs)(b.q,{right:!0,children:[Object(v.jsx)(b.n,{children:Object(v.jsx)(b.o,{activeClassName:"not-active",className:"waves-effect waves-light",to:"#!",children:Object(v.jsx)(b.k,{fab:!0,icon:"twitter"})})}),Object(v.jsx)(b.n,{children:Object(v.jsx)(b.o,{activeClassName:"not-active",className:"waves-effect waves-light",to:"#!",children:Object(v.jsx)(b.k,{fab:!0,icon:"google-plus-g"})})}),Object(v.jsx)(b.n,{children:Object(v.jsxs)(b.f,{children:[Object(v.jsx)(b.i,{nav:!0,caret:!0,children:Object(v.jsx)(b.k,{icon:"user"})}),Object(v.jsx)(b.h,{className:"dropdown-default",right:!0,children:null===(t=this.state.myNav.loginItem)||void 0===t?void 0:t.map((function(e,t){return console.log("LoginItems:",e),Object(v.jsx)(D,{name:e.name,route:e.route,captureEvent:function(r){a.handleChangeActive(r,e,t)},setRole:a.props.setRole,role:a.props.role},e.key)}))})]})})]})]})]})}}]),a}(r.Component),M=a(18),V=Object(M.a)(),B=(a(119),function(){return Object(v.jsx)("header",{children:Object(v.jsx)("div",{className:"view jarallax","data-jarallax":'{"speed": 0.2}',children:Object(v.jsx)("div",{className:"container h-100 d-flex justify-content-center align-items-center",children:Object(v.jsx)("div",{className:"row pt-5 mt-3",children:Object(v.jsx)("div",{className:"col-md-12 mb-3",children:Object(v.jsxs)("div",{className:"intro-info-content text-center",children:[Object(v.jsxs)("h1",{className:"display-3 mb-5 wow fadeInDown","data-wow-delay":"0.3s",children:["NEW",Object(v.jsx)("a",{className:"indigo-text font-weight-bold",href:"#!",children:"COLLECTION"})]}),Object(v.jsx)("h5",{className:"text-uppercase mb-5 mt-1 font-weight-bold wow fadeInDown","data-wow-delay":"0.3s",children:"Free delivery & special prices"}),Object(v.jsx)("a",{className:"btn btn-outline-indigo btn-lg wow fadeInDown","data-wow-delay":"0.3s",href:"#!",children:"Shop"}),Object(v.jsx)("a",{className:"btn btn-indigo btn-lg wow fadeInDown","data-wow-delay":"0.3s",href:"#!",children:"Lookbook"})]})})})})})})}),_=function(){var e,t,a,r,n=U();if(console.log("PageName:",n),""===n||"home"===n)t="home",a="activate",null===(r=document.querySelector("[name=products]"))||void 0===r||r.setAttribute("class"," de-activate nav-link Ripple-parent");else if("products"===n){var s;t="products",a="activate",null===(s=document.querySelector("[name=home]"))||void 0===s||s.setAttribute("class"," de-activate nav-link Ripple-parent")}else{var o,c;null===(o=document.querySelector("[name=home]"))||void 0===o||o.setAttribute("class"," de-activate nav-link Ripple-parent"),null===(c=document.querySelector("[name=products]"))||void 0===c||c.setAttribute("class"," de-activate nav-link Ripple-parent")}null===(e=document.querySelector("[name=".concat(t,"]")))||void 0===e||e.setAttribute("class",a+" nav-link Ripple-parent")},z=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state=void 0,r.state={},r}return Object(g.a)(a,[{key:"componentDidMount",value:function(){_()}},{key:"onClick",value:function(){this.setState({collapse:!this.state.collapse})}},{key:"render",value:function(){return Object(v.jsx)(n.a.Fragment,{children:Object(v.jsx)(B,{})})}}]),a}(r.Component),G=a(33),W=function(e){return Object(v.jsxs)(n.a.Fragment,{children:[Object(v.jsx)(b.u,{children:Object(v.jsx)("br",{})}),Object(v.jsxs)(b.u,{children:[Object(v.jsx)(b.c,{size:"auto",children:Object(v.jsx)("label",{id:e.id,htmlFor:e.id,children:e.label})}),Object(v.jsx)(b.c,{children:Object(v.jsx)("input",{"aria-labelledby":e.id,type:"text",className:e.className,id:e.id,"data-testid":e.testId,placeholder:e.placeholder,name:e.name,value:e.value,onChange:e.changeHandler})})]})]})},J=function(e){var t=e.getRole,a=Object(r.useState)({email:"",password:"",message:"",access_token:"",refresh_token:"",expiration:"",hasAccessTokenExpired:!1,isUserAuthorized:!1,authToken:"",token:""}),n=Object(G.a)(a,2),s=n[0],o=n[1],i=Object(f.f)(),d=function(){var e=Object(u.a)(l.a.mark((function e(a){var r,n,u,d,g,m,h,p,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.preventDefault(),r={email:s.email,password:s.password},e.prev=2,e.next=5,k.login(r);case 5:if(n=e.sent,console.log("RES: ".concat(JSON.stringify(n))),200!==(null===n||void 0===n?void 0:n.status)){e.next=18;break}return u=n.data,d=u.message,g=u.access_token,m=u.refresh_token,h=u.expiration,p=u.email,o((function(e){return Object(c.a)(Object(c.a)({},e),{},{access_token:g,expiration:h,refresh_token:m,message:d,email:p})})),e.next=12,T(g,m,h,p,d);case 12:return f=e.sent,console.log("test: ".concat(JSON.stringify(f))),e.next=16,t();case 16:o((function(e){return Object(c.a)(Object(c.a)({},e),{},{email:"",password:""})})),i.push("/products");case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(2),console.log("LOGIN ERROR",e.t0),o((function(t){return Object(c.a)(Object(c.a)({},t),{},{message:e.t0.message})}));case 24:case"end":return e.stop()}}),e,null,[[2,20]])})));return function(t){return e.apply(this,arguments)}}();return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)("main",{role:"main",className:"form-align flex-shrink-0",children:Object(v.jsx)(b.e,{children:Object(v.jsx)(b.u,{children:Object(v.jsx)(b.c,{size:"12",middle:!0,children:Object(v.jsxs)("form",{onSubmit:function(e){return d(e)},"data-testid":"login-form",children:[Object(v.jsx)("h1",{className:"mt-5",children:"Login Form"}),Object(v.jsx)("br",{}),Object(v.jsxs)("div",{className:"from-group",children:[Object(v.jsx)(W,{htmlFor:"formGroupEmail",className:"form-control",id:"formGroupEmail",testId:"login-email",label:"Email",name:"email",value:s.email,changeHandler:function(e){o((function(t){return Object(c.a)(Object(c.a)({},t),{},{email:e.target.value})}))}}),Object(v.jsx)(W,{htmlFor:"formGroupPassword",className:"form-control",id:"formGroupPassword",testId:"login-password",name:"password",label:"Password",value:s.password,changeHandler:function(e){o((function(t){return Object(c.a)(Object(c.a)({},t),{},{password:e.target.value})}))}}),Object(v.jsx)("br",{}),Object(v.jsx)(b.u,{children:Object(v.jsxs)(b.c,{children:[Object(v.jsx)("label",{htmlFor:"formGroupPassword"}),Object(v.jsx)(b.b,{type:"submit",className:"mx-0",color:"blue-grey",children:"Submit"}),Object(v.jsx)("h3",{className:"mt-5",children:s.message?s.message:""}),Object(v.jsx)("h3",{className:"mt-5",children:s.token?s.token:""})]})})]})]})})})})})})},K=function(e){var t=e.getRole;return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(J,{getRole:t})})},q=a(25);function Y(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=document.getElementById(e),n=r.value,s=document.getElementById(t),o=null===s||void 0===s?void 0:s.value,c=document.getElementById(a);if(c){var i=c.files[0];console.log("IMAGEFile:",i),i||(console.log("Image Input Border should be set to red"),c.setAttribute("class","image-input-error"))}n||(console.log("Style should be red"),r&&(r.style.borderColor="red")),o||(s.style.borderColor="red")}function Z(e,t){var a;null===(a=document.getElementById(e))||void 0===a||a.classList.remove(t)}function $(e){e.style.borderColor=""}a(120);var Q=function(e){return Object(v.jsx)(n.a.Fragment,{children:Object(v.jsxs)("div",{className:"input-group img-select-btn",children:[Object(v.jsx)("label",{className:"image-label  visually-hidden",htmlFor:e.submitBtnId,children:"Select Image:"}),Object(v.jsx)("input",{type:e.imageType,className:"".concat(e.imageClassName," border"),id:e.submitBtnId,ref:e.imageSelectRef,"aria-describedby":"inputGroupFileAddon01",name:e.imageName,accept:e.fileTypes,onChange:function(t){e.selectImage(t,e.imageSelectRef,e.previewCanvasRef)}})]})})},X=(a(121),function(e){var t=e.image,a=e.uploaderBorder,r=n.a.createRef(),s=n.a.createRef();return Object(v.jsxs)(n.a.Fragment,{children:[Object(v.jsx)(b.c,{size:"1",className:a}),Object(v.jsx)(b.c,{size:"4",children:Object(v.jsxs)("div",{className:"col-12 input-border",children:[Object(v.jsx)(b.u,{children:Object(v.jsx)("div",{className:"name-container name-container-border",children:Object(v.jsx)("div",{className:"preview",ref:s,children:Object(v.jsx)("p",{id:"file-msg"})})})}),Object(v.jsx)(b.u,{children:Object(v.jsx)(Q,{imageName:t.imageName,imageClassName:t.className,imageType:t.type,submitBtnId:t.submitBtnId,imageSelectRef:r,previewCanvasRef:s,aria:"inputGroupFileAddon01",fileTypes:".png, .jpeg, .jpg",selectImage:e.selectImage})})]})})]})}),ee=(a(122),function(e){return console.log("PRODUCTINSERTINPUTS",e.image),console.log("PRODUCTINSERT FileTypes",e.image.fileTypes),Object(v.jsx)("main",{className:"form-align",children:Object(v.jsx)(b.e,{children:Object(v.jsx)(b.u,{children:Object(v.jsx)(b.c,{size:"12",middle:!0,children:Object(v.jsxs)("form",{onSubmit:e.insertClickHandler,children:[Object(v.jsx)("h1",{className:"mt-5",children:"Product Insert Form"}),Object(v.jsx)("br",{}),Object(v.jsxs)("div",{className:"product-name-value-form-group",children:[Object(v.jsx)(W,{htmlFor:"insertFormGroupProductName",className:"form-control product-name",id:"insertFormGroupProductName",testId:"product-name",placeholder:e.placeholderName,name:"productName",label:"Name",value:e.productName,changeHandler:e.changeHandler}),Object(v.jsx)(W,{htmlFor:"insertFormGroupProductValue",className:"form-control product-value",id:"insertFormGroupProductValue",testId:"product-value",placeholder:e.placeholderValue,name:"productValue",label:"Value",value:e.productValue,changeHandler:e.changeHandler}),Object(v.jsx)("br",{}),Object(v.jsx)(b.u,{className:"image-require-border",children:Object(v.jsxs)(b.c,{size:"12",children:["Image Requirements (PNG, JPG):",Object(v.jsx)("br",{}),Object(v.jsx)(b.c,{size:"7",children:Object(v.jsxs)("div",{className:"col-12",children:[Object(v.jsx)("b",{children:"Filesize:"})," < ",e.image.maxMB,"MB, ",Object(v.jsx)("b",{children:"Dimensions: "}),"Min: ",e.image.imageMin,", Max: ",e.image.imageMax]})})]})}),Object(v.jsxs)(b.u,{role:"main",className:"upload-image-form-group image-require-border",children:[Object(v.jsx)("br",{}),Object(v.jsx)(X,{uploaderBorder:"uploader-border",image:e.image,submitImageHandler:e.submitImageHandler,productImage:e.productImage,selectImage:e.selectImage,setImageProp:e.setImageProp}),Object(v.jsxs)(b.c,{className:"image-require-border",children:[Object(v.jsx)("label",{htmlFor:"formGroupSubmitButton"}),Object(v.jsx)(b.b,{id:"submit-image",color:"blue-grey",type:"submit",children:"Submitfc"}),Object(v.jsx)("h3",{className:"mt-5",children:e.message?e.message:""})]})]})]})]})})})})})}),te={refresh:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s){var o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In REFRESHTOKENS:",r),e.next=3,k.refreshTokens(t,a,r,n,s);case 3:return o=e.sent,console.log("tokenStore: newCredentialResponse = ",o),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(t,a,r,n,s){return e.apply(this,arguments)}}()},ae={setLocalCredWNewTokens:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s){var o,c,i,u,d,g,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("ProductListContainer refresh-token: ",t),e.prev=1,console.log("CredentialStore: Before TokenStore Call"),e.next=5,te.refresh(a,r,t,n,s);case 5:if(o=e.sent,console.log("CredentialStore: After TokenStore Call"),console.log("ProductionList:response returned",o),200!==(null===o||void 0===o?void 0:o.status)){e.next=20;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED RES:",o),e.next=12,T(o.data.access_token,o.data.refresh_token,o.data.expiration,o.data.email,o.data.message);case 12:return c=e.sent,i=c.access_token,u=c.refresh_token,d=c.expiration,g=c.email,m=c.message,console.log("After setlocalStorage"),e.abrupt("return",{access_token:i,refresh_token:u,expiration:d,email:g,message:m});case 20:e.next=29;break;case 22:if(e.prev=22,e.t0=e.catch(1),401!==e.t0.response.status){e.next=29;break}return console.log("401 status received in ProductUpdate"),e.next=28,C();case 28:return e.abrupt("return",{authToken:"",access_token:"",refresh_token:"",expiration:null,email:"",hasAccessTokenExpired:!1,isUserAuthorized:!1,message:e.t0.response.data.message});case 29:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t,a,r,n,s){return e.apply(this,arguments)}}(),getEvaluatedCredentials:function(e){var t="Bearer "+e.access_token;console.log("In getEval:",t);var a=S();return{access_token:e.access_token,refresh_token:e.refresh_token,expiration:e.expiration,email:e.email,message:e.message,hasAccessTokenExpired:a,authToken:t,isUserAuthorized:!0,refreshed:!1}}},re=function(e){var t=e.name,a="Name: ".concat(t),r=e.value,n="Price: $".concat(r),s=e.id,o=e.image;return console.log("in productLIst:",e),Object(v.jsx)("div",{className:"container-fluid text-center",children:Object(v.jsx)("div",{className:"row",children:Object(v.jsxs)("div",{className:"col",children:[Object(v.jsx)("br",{}),Object(v.jsx)("img",{src:o,alt:"product ".concat(s)}),Object(v.jsx)("p",{className:"mt-2",children:Object(v.jsx)("b",{children:t?a:""})}),Object(v.jsxs)("p",{children:[Object(v.jsx)("b",{children:r?n:""}),Object(v.jsx)("br",{})]}),Object(v.jsx)("hr",{})]})})})},ne=function(){var e=Object(u.a)(l.a.mark((function e(t,a,r){var n,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.getProduct(t,a,r);case 2:return n=e.sent,s=n&&Object(c.a)({},n.data),console.log("@ProductDetails",s),o=Object(v.jsx)(re,{image:s.productImage,id:s._id,name:s.name,value:s.value},s._id),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),se=function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/api/products",e.prev=1,e.next=4,k.getProducts("/api/products");case 4:return t=e.sent,a=null===t||void 0===t?void 0:t.data.products,console.log("productStore:retrieveUpdatedProductList data =",a),e.abrupt("return",a);case 10:e.prev=10,e.t0=e.catch(1),console.log("ERROR",e.t0);case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(){return e.apply(this,arguments)}}();function oe(e,t,a,r,n,s){return ce.apply(this,arguments)}function ce(){return(ce=Object(u.a)(l.a.mark((function e(t,a,r,n,s,o){var c,i=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.length>6&&void 0!==i[6]?i[6]:null,i.length>7&&void 0!==i[7]?i[7]:null,i.length>8&&void 0!==i[8]?i[8]:null,console.log("IN DELETE PRODUCT CALL"),console.log("DATA URL: ".concat(t,", ATOKENT: ").concat(n,", RTOKEN: ").concat(s,", EXPIRED: ").concat(o,", EMAIL: ").concat(r)),e.next=7,k.deleteProduct(t,n,s,o,r);case 7:return c=e.sent,console.log("deleteProduct: ",c),e.abrupt("return",c);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s,o,c,i){var u,d,g=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=g.length>8&&void 0!==g[8]?g[8]:null,console.log("ProductStore:IN UPDATE PRODUCT CALL","expired",o),e.next=4,k.updateProduct(t,n,s,c,i,u,o,r);case 4:return d=e.sent,e.abrupt("return",d);case 6:case"end":return e.stop()}}),e)})));return function(t,a,r,n,s,o,c,i){return e.apply(this,arguments)}}(),le=function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n){var s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.insertCloudinary(t,a,r,n);case 2:return s=e.sent,e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,a,r,n){return e.apply(this,arguments)}}();function ue(e,t,a){return de.apply(this,arguments)}function de(){return(de=Object(u.a)(l.a.mark((function e(t,a,r){var n,s,o,c,i,u,d,g=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.length>3&&void 0!==g[3]?g[3]:null,s=g.length>4&&void 0!==g[4]?g[4]:null,o=g.length>5&&void 0!==g[5]?g[5]:null,c=g.length>6?g[6]:void 0,i=g.length>7?g[7]:void 0,u=g.length>8?g[8]:void 0,console.log("ProductStore: insertProduct: IN INSERT PRODUCT CALL"),console.log("ProductStore: insertProduct: Insert Product Image:",u),console.log("ProductStore: insertProduct: email:",r),e.next=11,k.insertProduct(t,a,r,n,s,c,i,u,o);case 11:return d=e.sent,e.abrupt("return",d);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ge=function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,r,n,s,o,c,i,u,d,g,m,h,p,f,b,v=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:"",a=v.length>1?v[1]:void 0,r=v.length>2?v[2]:void 0,n=v.length>3?v[3]:void 0,s=v.length>4?v[4]:void 0,o=v.length>5&&void 0!==v[5]?v[5]:null,c=v.length>6&&void 0!==v[6]?v[6]:null,i=v.length>7&&void 0!==v[7]?v[7]:null,u=v.length>8?v[8]:void 0,d=v.length>9?v[9]:void 0,g="Request failed with status code 500",m="Invalid Input",console.log("ProductStore: PerformDbAction:","email:",a),console.log("ProductUpdateContainer:refresh_token = ",n),e.prev=14,console.log("BEFORE UPDATE CALLED"),console.log("PerformDBAction Image:",i),e.next=19,d(u+t,t,a,r,n,s,o,c,i);case 19:if(h=e.sent,console.log("AFTER UPDATE CALLED"),console.log("RESPONSEMESSAGE ",JSON.stringify(h),"STATUS",h.status),200!==h.status&&201!==h.status){e.next=29;break}return e.next=25,se();case 25:return p=e.sent,console.log("retrievedUpdatedProductList:",p),f={message:"Action Completed",refresh_token:"norefresh",isUserAuthorized:!0,hasAccessTokenExpired:!1,productsList:p},e.abrupt("return",f);case 29:e.next=37;break;case 31:return e.prev=31,e.t0=e.catch(14),console.log("err:",e.t0.message),b={message:""},b=e.t0.message===g?{message:m}:{message:e.t0.message},e.abrupt("return",b);case 37:case"end":return e.stop()}}),e,null,[[14,31]])})));return function(){return e.apply(this,arguments)}}(),me=function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s,o,c,i,u,d){var g,m,h,p,f,b,v,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Start stageDBAction: performDBAction"),console.log("stageDBAction-email:",a),e.next=4,ge(t,a,i,c,u,r,n,s,o,d);case 4:return g=e.sent,console.log("PRODUCTINSERT: CONTAINER performDBAction dBActionResults:",g),"Action Completed"===(null===g||void 0===g?void 0:g.message)&&(r&&(m={placeholderName:r}),n&&(h={placeholderValue:n})),console.log("Passed performDBAction"),f=(p=g).message,b=p.isUserAuthorized,v=p.productsList,"Request failed with status code 401"===f&&(f="Please Login"),j=m&&h?{message:f,refreshToken:c,isUserAuthorized:b,expired:u,productsList:v,placeholderName:m?m.placeholderName:"",placeholderValue:h?h.placeholderValue:""}:{message:f,refreshToken:c,isUserAuthorized:b,hasAccessTokenExpired:u,productsList:v},console.log("STAGEDBACTION: productListData =",v),e.abrupt("return",j);case 13:case"end":return e.stop()}}),e)})));return function(t,a,r,n,s,o,c,i,l,u){return e.apply(this,arguments)}}(),he=function(e,t,a,r,n,s,o){e=document.createTextNode("File Name: "+a+", File Size: "+r+", Width: "+n+", Height: "+s);var c=document.createElement("li");c.setAttribute("id","li-id"),c.appendChild(e);var i=document.createElement("ol");o.appendChild(i),i.appendChild(c),c.style.color=t,pe("canvas",o)},pe=function(e,t){if(t){var a=t.getElementsByTagName("".concat(e)),r=!!a.length;console.log("item Length",a.length),console.log("is item created",r),console.log("no item",a),r&&t.removeChild(a[0])}},fe=function(e){e&&(e.getElementsByTagName("canvas").length>=1&&(pe("canvas",e),pe("ol",e)))},be=function(e,t){var a=document.getElementById(e);a&&(a.innerHTML=t)},ve=function(e){return je(e[0].size)},je=function(e){return e<1024?e+"bytes":e>=1024&&e<1048576?(e/1024).toFixed(1)+"KB":e>=1048576?(e/1048576).toFixed(1)+"MB":void 0},xe=function(e,t,a){e.onload=function(){t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,t.width/2-e.width/2,t.height/2-e.height/2),t.setAttribute("class","img-fluid"),a.prepend(t)}},Oe=function(e,t,a,r,n,s,o,c,i,l){var u=document.createTextNode("");e?(s=ve(o),he(u,"black",n,s,i,l,c),be(t,a),document.getElementById("submit-image").disabled=!1):(console.log("****DIMENSIONS NOT VALID****"),document.getElementById("submit-image").disabled=!0,s=ve(o),he(u,"red",n,s,i,l,c),be(t,r));return s},ke=function(e){return e?e.files:null},Ee=function(e,t,a,r,n,s){t<=a&&r<=a&&(console.log("NOT A Valid File: "),be(n,s),document.getElementById("submit-image").disabled=!0,console.log("IMAGE ERROR ONLOAD"));fe(e),console.log("in imgONERROR")},Ne=function(e,t,a){var r=a.getElementsByTagName("canvas"),n=document.createElement("canvas");console.log("DISPLAYIMAGE CANVASELEMENT:",r),t&&(0===r.length||pe("canvas",a),xe(e,n,a))},Ie=function(e,t){return console.log("IMG",e,"BLOB",t),new Promise((function(a,r){e.src=URL.createObjectURL(t),e.onload=function(){var r={imageName:t.name,imageHeight:e.height,imageWidth:e.width,imageSize:t.size,imageSrc:e.src};a(r)},e.onerror=function(){r("rejected")}}))},Se=function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("In convertImageStart"),(a=new Image).crossOrigin="Anonymous",e.abrupt("return",new Promise((function(e,n){console.log("URL1: ",t),a.src=t,console.log("URL2: ",t),a.onload=function(){var t=document.createElement("canvas");console.log("canvas width: ".concat(t.width)),t.width=a.width,t.height=a.height,console.log("IMGWIDTH:",a.width,"IMGHEIGHT:",a.height);var n=t.getContext("2d");console.log("canvas width: ".concat(t.width)),n.drawImage(a,t.width/2-a.width/2,t.height/2-a.height/2),r=t.toDataURL("image/jpg"),console.log("Images loaded helper.js resolved",typeof r),e(r)},a.onerror=function(e){n("image rejected in BASE64 Conversion:"+e)}})));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Te=function(e,t){if(!e)return!1;console.log("FILEType :",e.type);for(var a=0;a<t.length;a++)if(e.type===t[a])return!0},Ae=(a(123),function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).cloudinaryURL="/api/products/cloudinary/insert/",r.refreshURL="/api/user/login/refresh",r.baseURL="/api/products/product/insert/",r.message=function(){console.log("Message method called")},r.state={productId:"",productName:"",ProductInsertForm:"",productImage:"",placeholderName:"",placeholderValue:"",productsList:[],authToken:"",refresh_token:"",email:"",hasAccessTokenExpired:!1,isUserAuthorized:!0,message:"",image:{base64Str:"",cloudImageUrl:"",cloudImagePublicId:"",input:"",file:"",submitBtnId:"image-input",fileTypes:["image/jpeg","image/jpg","image/png"],imageName:"",imageWidth:0,imageHeight:0,imageSize:0,imageSrc:"",imageMin:200,imageMax:450,maxMB:2,errorTag:"file-msg",invalidMsg:"Not a valid file.",unacceptedMsg:"File not accepted.",acceptedMsg:"File accepted.",fileMsgElement:"",previewCanvasElement:"",submitImageElement:"",className:"customFileInput",type:"file"}},r.changeHandler=r.changeHandler.bind(Object(m.a)(r)),r.insertClickHandler=r.insertClickHandler.bind(Object(m.a)(r)),r.insertProduct=ue.bind(Object(m.a)(r)),r.productImageClickHandler=r.productImageClickHandler.bind(Object(m.a)(r)),r.submitImageHandler=r.submitImageHandler.bind(Object(m.a)(r)),r.selectImage=r.selectImage.bind(Object(m.a)(r)),r.setImageProp=r.setImageProp.bind(Object(m.a)(r)),r.message=r.message.bind(Object(m.a)(r)),r}return Object(g.a)(a,[{key:"setElementRef",value:function(){this.setImageProp("fileMsgElement",document.getElementById(this.state.image.errorTag)),console.log("ImageUploaderStateMounted",this.state.image.imageMin)}},{key:"selectImage",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r){var n,s,o,c,i,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.persist(),console.log("EVENT:",t),console.log("IMGREF:",a,"; PVCanvasRef:",r),console.log("SELECTIMAGE imageSelectRef:",null===a||void 0===a?void 0:a.current,"previewCanvasRef:",null===r||void 0===r?void 0:r.current,"imageSelectRef1:",typeof a),n=null===r||void 0===r?void 0:r.current,s=null===a||void 0===a?void 0:a.current,this.setImageProp("previewCanvasElement",n),this.setImageProp("input",s),o=this.state.image,console.log("In Contanier: imagebtn:",o.submitBtnId,"file:",o.input,"file2",o.file),e.next=12,this.productImageClickHandler(t);case 12:if(this.setState({image:o}),console.log("FILE INPUT: ",this.state.image.input),this.setImageProp("file",this.state.image.file),!ke(o.input)||!Te(o.file,o.fileTypes)){e.next=45;break}return i=o.input.files[0],c=new Image,e.prev=18,e.next=21,Ie(c,i);case 21:u=e.sent,console.log("loadedImgResult",u),c.src=u.imageSrc.toString(),this.setImageProp("imageSrc",u.imageSrc),this.setImageProp("imageWidth",u.imageWidth),this.setImageProp("imageHeight",u.imageHeight),this.setImageProp("imageSize",u.imageSize),this.setImageProp("imageName",u.imageName),console.log("DISPLAYIMAGE PREVIEW CANVAS:",o.previewCanvasElement,"*","state:",this.state.image.previewCanvasElement),pe("ol",o.previewCanvasElement),l=o.imageWidth,g=o.imageMin,m=o.imageHeight,h=o.imageMax,d=l>=g&&l<=h&&m>=g&&m<=h,console.log("AREDIMENSIONSVALID:",d),this.setImageProp("imageSize",Oe(d,o.errorTag,o.acceptedMsg,o.unacceptedMsg,o.imageName,o.imageSize,o.input.files,o.previewCanvasElement,o.imageWidth,o.imageHeight)),Ne(c,d,o.previewCanvasElement),this.setState({image:o}),Z("image-input","image-input-error"),e.next=43;break;case 39:e.prev=39,e.t0=e.catch(18),console.log("failure ",e.t0),Ee(o.previewCanvasElement,o.imageWidth,o.imageMax,o.imageHeight,o.errorTag,o.invalidMsg);case 43:e.next=47;break;case 45:fe(o.previewCanvasElement),be(o.errorTag,o.unacceptedMsg);case 47:case"end":return e.stop()}var l,g,m,h}),e,this,[[18,39]])})));return function(t,a,r){return e.apply(this,arguments)}}()},{key:"setImageProp",value:function(e,t){var a=this.state.image;console.log("setImageProp",a,"Key",e,"Value",t),a[e]=t,console.log("image: ",a),this.setState({image:a}),console.log("Key:",[e]),console.log("Value:",t),console.log("Image ".concat(e,":"),this.state.image[e])}},{key:"submitImageHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a){var r,n,s,o,c,i,u,d,g,m,h,p,f,b,v,j,x,O,k,E,N,I,S,T;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.persist(),console.log("IN SUBMITIMAGEHANDLER"),n=a.input,s=a.imageWidth,o=a.imageHeight,c=a.imageMin,i=a.imageMax,u=a.imageName,d=a.imageSize,g=a.maxMB,m=a.errorTag,h=a.acceptedMsg,p=a.unacceptedMsg,f=a.fileMsgElement,b=a.previewCanvasElement,v=a.imageSrc,this.setState({image:a}),!ke(n)){e.next=45;break}if(console.log("ActionHelper file selected"),j=!1,j=s>=c&&s<=i&&o>=c&&o<=i,console.log("FileName:",u),console.log("FileSize:",d),x=d.slice(-2).toLowerCase(),O=d.replace(/[^\d.-]/g,""),console.log("FILESIZE = "+O+", Unit = "+x),console.log("Max File Size:",g),"mb"===x?(console.log("max file size:",g,", actual file size:",O),j=O<=g):"kb"===x&&(j=O<=1e3*g),console.log("Is Input File Valid:",j),j){e.next=21;break}console.log("image not acceptable"),be(m,f?p:h),e.next=42;break;case 21:return console.log("Image is acceptable"),k=v,console.log("Call convertImageFromURLTOBase"),e.next=26,Se(k);case 26:return E=e.sent,console.log("***Base64StringImage: ".concat(typeof E)),console.log("Calling productStore.insertCloudinary"),e.next=31,A();case 31:return N=e.sent,console.log("CurrentCredentials:",N),I="Bearer "+N.access_token,console.log("ProdInsertCont-AuthToken:",I),S=N.refresh_token,console.log("ProdInsertCont-RefreshToken:",S),e.next=39,le(this.cloudinaryURL,E,I,S);case 39:T=e.sent,console.log("CloudinaryResult:",T),T&&(console.log("Converted Image: ",E),r=this.state.image,console.log("CLOUD URL:",null===T||void 0===T?void 0:T.data.url),r.cloudImageUrl=null===T||void 0===T?void 0:T.data.url,console.log("CLOUD IMAGEURL:",r.cloudImageUrl),r.cloudImagePublicId=null===T||void 0===T?void 0:T.data.public_id,console.log("public_id",r.cloudImagePublicId),r.base64Str=E,console.log("Image:",r),this.setState({image:r}),console.log("State image: ",this.state.image,"cloud image url",this.state.image.cloudImageUrl));case 42:return fe(b),e.next=45,this.productImageClickHandler(t);case 45:console.log("SubmitImageHandler: file NOT selected");case 46:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"setStateVariables",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s){var o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="Bearer "+t,console.log("Auth token",o),this.setState({authToken:o}),console.log("Refresh token",a),this.setState({refresh_token:a}),this.setState({email:n}),e.next=8,S();case 8:c=e.sent,console.log("Expired?",c),this.setState({hasAccessTokenExpired:c}),this.setState({isUserAuthorized:!0}),this.setState({message:s});case 13:case"end":return e.stop()}}),e,this)})));return function(t,a,r,n,s){return e.apply(this,arguments)}}()},{key:"resetStateVariables",value:function(){this.setState({authToken:""}),this.setState({access_token:""}),this.setState({refresh_token:""}),this.setState({email:""}),this.setState({hasAccessTokenExpired:!1})}},{key:"componentDidMount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,t=e.location;if(this.setElementRef(),t.state){var a=t.state,r=a.name,n=a.value,s=this.state.image;s.imageName="Choose File",this.setState({placeholderName:r,placeholderValue:"$ ".concat(n),image:s})}}},{key:"changeHandler",value:function(e){e.preventDefault();var t=e.target,a=t.name,r=t.value;a&&"string"===typeof r&&(this.setState(Object(q.a)({},a,r)),"red"===e.target.style.borderColor&&$(e.target))}},{key:"insertClickHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,n,s,o,c,i,u,d,g,m,h,p,f,b;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log("PRODUCTINSERTCONTAINER: insertCLICKHANDLER CLICKED"),e.prev=2,a=this.state.productName,r=this.state.productValue,n=this.state.image.input,e.next=8,A();case 8:return s=e.sent,o=s.access_token,c=s.refresh_token,i=s.expiration,u=s.email,e.next=15,this.setStateVariables(o,c,i,u,this.state.message);case 15:if(console.log("hasAccessTokenExpired",this.state.hasAccessTokenExpired),!this.state.hasAccessTokenExpired){e.next=51;break}return console.log("ProductInsertContainer refresh-token: ",this.state.refresh_token),e.prev=18,e.next=21,ae.setLocalCredWNewTokens(this.state.refresh_token,this.refreshURL,this.state.authToken,this.state.email,this.state.hasAccessTokenExpired);case 21:if(d=e.sent,console.log("newUserCredentials STATUS",d),!d){e.next=34;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED newUserCredentials:",d),e.t0=ae,e.next=28,A();case 28:e.t1=e.sent,g=e.t0.getEvaluatedCredentials.call(e.t0,e.t1),this.setState(g),console.log("New AUTHTOKEN after Refresh:",this.state.authToken),e.next=35;break;case 34:console.log("I NEVER MADE IT TO IF");case 35:e.next=51;break;case 37:if(e.prev=37,e.t2=e.catch(18),console.log("ERRORED OUT IN Insert CATCH",e.t2),!e.t2.response||401!==(null===(m=e.t2.response)||void 0===m?void 0:m.status)){e.next=51;break}return console.log("401 status received in ProductInsert"),e.next=44,C();case 44:return e.next=46,this.resetStateVariables();case 46:console.log("err",e.t2.response),console.log("error status code",null===(h=e.t2.response)||void 0===h?void 0:h.status),this.setState({isUserAuthorized:!1}),console.log("isUserAuthorised = ",this.state.isUserAuthorized),this.setState({message:null===(p=e.t2.response)||void 0===p?void 0:p.data.message});case 51:if(console.log("AUTHORIZED?:",this.state.isUserAuthorized),!this.state.isUserAuthorized){e.next=67;break}return console.log("ProductInsertContainer:refresh_token = ",this.state.refresh_token),e.next=56,this.submitImageHandler(t,this.state.image);case 56:if(console.log("In stage"),a&&r&&n){e.next=61;break}Y("insertFormGroupProductName","insertFormGroupProductValue","image-input"),e.next=67;break;case 61:return e.next=63,me(this.state.productId,this.state.email,a,r,this.state.image,this.baseURL,this.state.refresh_token,this.state.authToken,this.state.hasAccessTokenExpired,ue);case 63:f=e.sent,console.log("Out stage"),console.log("ProductInsertContainer:",f),this.setState(f);case 67:e.next=72;break;case 69:e.prev=69,e.t3=e.catch(2),e.t3 instanceof Error&&(console.log(e.t3),b="Request failed with status code 401"===e.t3.message?"Please Login":"",this.setState({message:b}));case 72:case"end":return e.stop()}}),e,this,[[2,69],[18,37]])})));return function(t){return e.apply(this,arguments)}}()},{key:"productImageClickHandler",value:function(e){e.persist();var t,a,r,n,s,o=document.getElementById(this.state.image.submitBtnId),c=document.querySelector("#img-select-label");(console.log("QUERY SELECTOR",null===c||void 0===c?void 0:c.innerHTML),console.log("Image Selector Element",o),o.labels&&o.files)&&(console.log("ELEMENT:",null===o||void 0===o?void 0:o.files),a=null===(n=t=null===o||void 0===o?void 0:o.labels[0])||void 0===n?void 0:n.textContent,r=null===o||void 0===o?void 0:o.files[0]);if(e.target||((s=this.state.image).imageName="No File Chosen",console.log("ELSE: IMAGENAME:",s.imageName),this.setState({image:s}),a=this.state.image.imageName,console.log("LabelElement:",t),console.log("LabelValue:",a)),r&&o.files){var i;console.log("IMG Select EVENT INFO",e.target);var l=null===o||void 0===o?void 0:o.files[0].name.toString(),u=null===(i=t)||void 0===i?void 0:i.textContent;console.log("PRODUCTIMAGECLICKHANDLER:",null===o||void 0===o?void 0:o.baseURI),console.log("LabelValue:",u),console.log("FILENAME:",l),(s=this.state.image).imageName=l,console.log("IF: IMAGENAME:",s.imageName),s.file=r,console.log("ProductImageClickHandler file:",this.state.image.file),this.setState({image:s}),console.log("ProductImageClickHandler Image Path:",r),console.log("ProductImageName:",this.state.image.imageName),u=this.state.image.imageName,console.log("labelElement:",t),console.log("labelValue:",u)}else(s=this.state.image).imageName="No File Chosen",console.log("ELSE: IMAGENAME:",s.imageName),this.setImageProp(s,s),a=this.state.imageName}},{key:"render",value:function(){var e=this,t=this.props.role,a=this.props.loggedOut;if(console.log("User loggedOut:",a," role:",t),this.state.image)return Object(v.jsx)(v.Fragment,{children:a?"":Object(v.jsx)(P,{role:t,perform:"products:update",yes:function(){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(ee,{changeHandler:e.changeHandler,insertClickHandler:e.insertClickHandler,productImageName:e.state.image.imageName,productName:e.state.productName,productValue:e.state.productValue,productImage:e.state.productImage,placeholderName:e.state.placeholderName,placeholderValue:e.state.placeholderValue,message:e.state.message,image:e.state.image,submitImageHandler:e.submitImageHandler,selectImage:e.selectImage,setImageProp:e.setImageProp})})},no:function(){return Object(v.jsx)(v.Fragment,{})}})})}}]),a}(r.Component)),Ce=(a(124),a(23));var we=function(e){console.log("IMG Props:",e);var t=e.to.state.name,a=e.loggedOut,r=e.userRole,n=Object(v.jsx)(Ce.a,{to:e.to,className:"view overlay zoom rounded",children:Object(v.jsx)("img",{className:"card-img-top image-rules img-fluid",src:e.productImage,alt:"product ".concat(e.id)})}),s=Object(v.jsx)("a",{className:"view overlay zoom rounded",href:"#!",children:Object(v.jsx)("img",{className:"card-img-top image-rules img-fluid",src:e.productImage,alt:"product ".concat(e.id)})});return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)("div",{className:"card-wrapper inline-block",children:Object(v.jsxs)("div",{className:"card card-rotating",children:[Object(v.jsx)(P,{role:r,perform:"products:view",yes:function(){return Object(v.jsx)(v.Fragment,{children:a?s:n})},no:function(){return Object(v.jsx)(v.Fragment,{children:s})}}),Object(v.jsx)("a",{href:"#!",children:Object(v.jsx)("div",{className:"mask rgba-white-slight"})}),Object(v.jsx)("div",{className:"card-body card-body-cascade text-center",children:Object(v.jsx)("h4",{className:"card-title",children:Object(v.jsx)("strong",{children:t})})})]})})})},ye=function(e){return Object(v.jsx)(we,{to:{pathname:"".concat(e.viewPath).concat(e.id),state:{name:e.name,value:e.value,id:e.id,userRole:e.userRole}},productImage:e.productImage,id:e.id,userRole:e.userRole,loggedOut:e.loggedOut})},Re=function(e){var t=e.name,a=e.value,r=e.id,n=e.productImage.replace(/['"']+/g,""),s=e.role;console.log("PRODUCTLISTITEM-USERRole:",s);var o=e.loggedOut;return console.log("User loggedOut:",o," role:",s),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(ye,{productImage:n,id:r,userRole:s,loggedOut:o,value:a,name:t,viewPath:"/products/product/"})})},Pe=a(65),Ue=a(66),Le=(a(127),function(){return Object(v.jsx)(n.a.Fragment,{children:Object(v.jsx)("div",{className:"fas fa-spin center",children:Object(v.jsx)(Pe.a,{icon:Ue.a,size:"5x",color:"#3B5998"})})})}),He=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).baseURL="/api/products",r.state=void 0,r.state={productsListData:[],access_token:"",authToken:"",refresh_token:"",expiration:"",email:"",hasAccessTokenExpired:!1,isUserAuthorized:!0,loading:!1,message:"",role:r.props.role,loggedOut:r.props.loggedOut},r}return Object(g.a)(a,[{key:"resetStateVariables",value:function(){this.setState({authToken:""}),this.setState({access_token:""}),this.setState({refresh_token:""}),this.setState({email:""}),this.setState({hasAccessTokenExpired:!1})}},{key:"componentDidMount",value:function(){this.returnProducts(this.baseURL),this.setState({refreshed:!1}),_()}},{key:"returnProducts",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.prev=1,e.next=4,k.getProducts(t);case 4:a=e.sent,console.log("**RES: 1rst",a),a&&(this.productsListData=a.data.products,this.setState({loading:!1})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"productsListData",get:function(){return this.state.productsListData},set:function(e){var t=this;A().then((function(e){t.setState(e)})),console.log("----Data",e),this.setState({productsListData:e})}},{key:"products",get:function(){var e,t=this;return null===(e=this.productsListData)||void 0===e?void 0:e.map((function(e){return console.log("ProductListContainer: Product:",e),Object(v.jsx)(Re,{role:t.state.role,id:e._id,name:e.name,value:e.value,productImage:e.productImage,loggedOut:t.props.loggedOut},e._id)}))}},{key:"render",value:function(){if(!0===this.state.loading)return console.log("loading..."),Object(v.jsx)(Le,{});var e=this.state.role;return console.log("ProductListContainer: userRole =",e,"LoggedOut:",this.state.loggedOut),console.log("****Setting productListData in ProductsListContainer: Render-285:"),Object(v.jsx)(n.a.Fragment,{children:Object(v.jsx)("div",{className:"container-fluid text-center",children:Object(v.jsx)("div",{className:"row",children:Object(v.jsxs)("div",{className:"col",children:[Object(v.jsx)("br",{}),this.productsListData?this.products:""]})})})})}}]),a}(r.Component),De=function(e){var t=e.message,a="Request failed with status code 401"===t?"Please login":t;return Object(v.jsx)("main",{role:"main",className:"form-align flex-shrink-0",children:Object(v.jsx)(b.e,{children:Object(v.jsx)(b.u,{children:Object(v.jsx)(b.c,{size:"12",middle:!0,children:Object(v.jsxs)("form",{children:[Object(v.jsx)("h1",{className:"mt-5",children:"Product Update Form"}),Object(v.jsx)("br",{}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)(W,{htmlFor:"formGroupEmail",className:"form-control product-name",id:"formGroupName",testId:"update-name",placeholder:e.placeholderName,label:"Name",name:"productName",value:e.productName,changeHandler:e.changeHandler}),Object(v.jsx)(W,{htmlFor:"formGroupName",className:"form-control",id:"formGroupValue",testId:"update-value",placeholder:e.placeholderValue,name:"productValue",label:"Price",value:e.productValue,changeHandler:e.changeHandler}),Object(v.jsx)("br",{}),Object(v.jsx)(b.u,{children:Object(v.jsxs)(b.c,{children:[Object(v.jsx)("label",{htmlFor:"formGroupName"}),Object(v.jsx)(b.b,{className:"mx-0",color:"blue-grey",onClick:e.updateClickHandler,children:"Submit"}),Object(v.jsx)("h3",{className:"mt-5",children:a})]})})]})]})})})})})},Fe=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var r;Object(d.a)(this,a),(r=t.call(this,e)).refreshURL=void 0,r.baseURL=void 0,r.state=void 0;var n=e.location.state,s=null===n||void 0===n?void 0:n.name,o=null===n||void 0===n?void 0:n.value;return r.refreshURL="/user/login/refresh",r.baseURL="/api/products/product/update/",r.state={productItemComponent:null,productId:"",productName:"",productValue:"",placeholderName:"",placeholderValue:"",authToken:"",refresh_token:"",email:"",hasAccessTokenExpired:!1,isUserAuthorized:!0,message:""},r.setState({productName:s}),r.setState({productValue:o}),r.changeHandler=r.changeHandler.bind(Object(m.a)(r)),r.updateClickHandler=r.updateClickHandler.bind(Object(m.a)(r)),r}return Object(g.a)(a,[{key:"productItemComponent",get:function(){return this.state.productItemComponent},set:function(e){this.setState({productItemComponent:e})}},{key:"setStateVariables",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s){var o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="Bearer "+t,console.log("Auth token",o),this.setState({authToken:o}),console.log("Refresh token",a),this.setState({refresh_token:a}),this.setState({email:n}),e.next=8,S();case 8:c=e.sent,console.log("Expired?",c),this.setState({hasAccessTokenExpired:c}),this.setState({isUserAuthorized:!0}),this.setState({message:s});case 13:case"end":return e.stop()}}),e,this)})));return function(t,a,r,n,s){return e.apply(this,arguments)}}()},{key:"resetStateVariables",value:function(){this.setState({authToken:""}),this.setState({access_token:""}),this.setState({refresh_token:""}),this.setState({email:""}),this.setState({hasAccessTokenExpired:!1})}},{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,r,n,s,o,c,i,u,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _(),t=window.location.pathname,(a=t.split("/")).splice(3,1),a.splice(0,1,"/api"),r=a.join("/"),e.t0=ae,e.next=9,A();case 9:if(e.t1=e.sent,n=e.t0.getEvaluatedCredentials.call(e.t0,e.t1),this.setState(n),console.log("AUTHTOKEN Set to LocalStorage:",this.state.authToken),console.log("hasAccessTokenExpired",this.state.hasAccessTokenExpired),!this.state.hasAccessTokenExpired){e.next=41;break}return e.prev=15,e.next=18,ae.setLocalCredWNewTokens(this.state.refresh_token,this.refreshURL,this.state.authToken,this.state.email,this.state.hasAccessTokenExpired);case 18:if(!(s=e.sent)){e.next=30;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED newUserCredentials:",s),e.t2=ae,e.next=24,A();case 24:e.t3=e.sent,o=e.t2.getEvaluatedCredentials.call(e.t2,e.t3),this.setState(o),console.log("New AUTHTOKEN after Refresh:",this.state.authToken),e.next=32;break;case 30:this.props.setRole("visitor",!0),C();case 32:e.next=41;break;case 34:if(e.prev=34,e.t4=e.catch(15),console.log("err: ",e.t4),401!==e.t4.response.status){e.next=41;break}return console.log("401 status received in ProductInsert"),e.next=41,C();case 41:if(console.log("ProductUpdateContainer AUTHORIZED?:",this.state.isUserAuthorized),!this.state.isUserAuthorized){e.next=48;break}return e.next=45,ne(r,this.state.authToken,this.state.refresh_token);case 45:this.productItemComponent=e.sent,c=this.productItemComponent.props,i=c.name,u=c.value,(d=c.id)&&i&&u&&this.setState({productId:d,placeholderName:i,placeholderValue:"$".concat(u)});case 48:case"end":return e.stop()}}),e,this,[[15,34]])})));return function(){return e.apply(this,arguments)}}()},{key:"changeHandler",value:function(e){e.preventDefault();var t=e.target,a=t.name,r=t.value;a&&"string"===typeof r&&this.setState(Object(q.a)({},a,r))}},{key:"stageDBAction",value:function(){var e=Object(u.a)(l.a.mark((function e(t,a,r,n,s){var o,c,i,u,d,g,m,h=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.length>5&&void 0!==h[5]?h[5]:null,o=h.length>6?h[6]:void 0,console.log("Start performDBAction"),console.log("hasExpired0:",this.state.hasAccessTokenExpired),e.next=6,ge(t,a,this.state.refresh_token,this.state.authToken,this.state.hasAccessTokenExpired,r,n,null,s,o);case 6:c=e.sent,console.log("hasExpired1:",this.state.hasAccessTokenExpired),"Action Completed"===(null===c||void 0===c?void 0:c.message)&&(r&&this.setState({placeholderName:r}),n&&this.setState({placeholderValue:n})),console.log("Passed performDBAction"),u=(i=c).message,d=i.refresh_token,g=i.isUserAuthorized,m=i.hasAccessTokenExpired,console.log("hasAccessTokenExpired2:",m),this.setState({message:u,refresh_token:d,isUserAuthorized:g,hasAccessTokenExpired:m});case 13:case"end":return e.stop()}}),e,this)})));return function(t,a,r,n,s){return e.apply(this,arguments)}}()},{key:"updateClickHandler",value:function(){var e=Object(u.a)(l.a.mark((function e(t){var a,r,n,s,o,c,i,u,d,g;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),a=this.state.productName,r=this.state.productValue,e.next=6,A();case 6:return n=e.sent,s=n.access_token,o=n.refresh_token,c=n.expiration,i=n.email,u=n.message,e.next=14,this.setStateVariables(s,o,c,i,u);case 14:if(console.log("HasAccessTokenExpired",this.state.hasAccessTokenExpired),!this.state.hasAccessTokenExpired){e.next=50;break}return console.log("ProductUpdateContainer refresh-token: ",this.state.refresh_token),e.prev=17,e.next=20,ae.setLocalCredWNewTokens(this.state.refresh_token,this.refreshURL,this.state.authToken,this.state.email,this.state.hasAccessTokenExpired);case 20:if(!(d=e.sent)){e.next=32;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED From Refresh; newUserCredentials:",d),e.t0=ae,e.next=26,A();case 26:e.t1=e.sent,g=e.t0.getEvaluatedCredentials.call(e.t0,e.t1),this.setState(g),console.log("New AUTHTOKEN after Refresh:",this.state.authToken),e.next=34;break;case 32:this.props.setRole("visitor",!0),C();case 34:e.next=50;break;case 36:if(e.prev=36,e.t2=e.catch(17),console.log("ERRORED OUT IN UPDATE CATCH"),401!==e.t2.response.status){e.next=50;break}return console.log("401 Unauthorized user"),e.next=43,C();case 43:return e.next=45,this.resetStateVariables();case 45:console.log("err",e.t2.response),console.log("error status code",e.t2.response.status),this.setState({isUserAuthorized:!1}),console.log("isUserAuthorised = ",this.state.isUserAuthorized),this.setState({message:"401 Unauthorized user"});case 50:if(console.log("AUTHORIZED?:",this.state.isUserAuthorized),!this.state.isUserAuthorized){e.next=55;break}return console.log("ProductUpdateContainer:refresh_token = ",this.state.refresh_token),e.next=55,this.stageDBAction(this.state.productId,i,a,r,this.baseURL,null,ie);case 55:e.next=61;break;case 57:e.prev=57,e.t3=e.catch(0),console.log("User is logged out"),this.setState({message:"User is logged out"});case 61:case"end":return e.stop()}}),e,this,[[0,57],[17,36]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.role,a=this.props.loggedOut;return console.log("User loggedOut:",a," role:",t),Object(v.jsx)(v.Fragment,{children:a?"":Object(v.jsx)(P,{role:t,perform:"products:update",yes:function(){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(De,{changeHandler:e.changeHandler,updateClickHandler:e.updateClickHandler,productName:e.state.productName,productValue:e.state.productValue,placeholderName:e.state.placeholderName,placeholderValue:e.state.placeholderValue,message:e.state.message})})},no:function(){return Object(v.jsx)(v.Fragment,{})}})})}}]),a}(r.Component);a(128);var Me=function(e){return Object(v.jsx)(Ce.a,{to:e.to,children:Object(v.jsx)("button",{type:"button",className:"btn custom-btn",tabIndex:0,children:e.buttonName})})},Ve=function(e){return Object(v.jsx)(Me,{to:{pathname:"".concat(e.path).concat(e.id)},buttonName:e.btnName})};a(129);var Be=function(e){var t=e.id,a=e.id,r=e.btnClickHandler;return Object(v.jsx)("button",{type:"button",className:"btn custom-btn",tabIndex:0,onClick:function(e){r(e)},id:a,children:e.buttonName},t)},_e=function(e){return Object(v.jsx)(Be,{buttonName:e.btnName,id:e.id,btnClickHandler:e.btnClickHandler})},ze=function(e){var t,a="/user/login/refresh",s=Object(r.useState)({productItemComponent:null,baseUrl:"",access_token:"",authToken:"",refresh_token:"",expiration:"",email:"",hasAccessTokenExpired:!1,isUserAuthorized:!0,loading:!1,message:""}),o=Object(G.a)(s,2),i=o[0],d=o[1];Object(r.useEffect)((function(){_();var t=window.location.pathname;console.log("URL: ".concat(t));var r=t.split("/");console.log("@@@URLARRAY:",r),r.splice(0,1,"/api");var n=r.join("/");console.log("baseUrl:",n),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=ae,e.next=3,A();case 3:e.t1=e.sent,t=e.t0.getEvaluatedCredentials.call(e.t0,e.t1),console.log("FetchCredentials:",t),d((function(e){return Object(c.a)(Object(c.a)({},e),t)})),console.log("FetchCredentials: STATE: ".concat(JSON.stringify(i))),console.log("ProductViewContainer-AUTHTOKEN Set to LocalStorage:",i.authToken);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),function(){var t=Object(u.a)(l.a.mark((function t(){var r,n,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i.hasAccessTokenExpired){t.next=30;break}return t.prev=1,t.next=4,ae.setLocalCredWNewTokens(i.refresh_token,a,i.authToken,i.email,i.hasAccessTokenExpired);case 4:if(r=t.sent,console.log("FetchAccessTokens: userCredentials: ".concat(JSON.stringify(r))),console.log("FetchAccessTokens: userCredentialsTEST"),!r){t.next=19;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED userCredentials:",r),t.t0=ae,t.next=12,A();case 12:t.t1=t.sent,n=t.t0.getEvaluatedCredentials.call(t.t0,t.t1),console.log("FetchAccessTokens: EVALUATEDCREDENTIALS:",n),d((function(e){return Object(c.a)(Object(c.a)({},e),n)})),console.log("New AUTHTOKEN0 after Refresh: ".concat(JSON.stringify(i))),t.next=21;break;case 19:e.setRole("visitor",!0),C();case 21:t.next=30;break;case 23:if(t.prev=23,t.t2=t.catch(1),console.log("err: ",t.t2),401!==(null===(s=t.t2.response)||void 0===s?void 0:s.status)){t.next=30;break}return console.log("401 status received in ProductInsert"),t.next=30,C();case 30:case"end":return t.stop()}}),t,null,[[1,23]])})));return function(){return t.apply(this,arguments)}}()(),function(){var t=Object(u.a)(l.a.mark((function t(){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i.isUserAuthorized){t.next=9;break}return console.log("EMAIL IN STAGEDBACTION:",i.email),t.next=4,ne(n,i.authToken,i.refresh_token);case 4:a=t.sent,console.log("FetchProducts: ITEMS:",JSON.stringify(a)),d((function(e){return Object(c.a)(Object(c.a)({},e),{},{productItemComponent:a})})),t.next=10;break;case 9:console.log("USER NOTE AUTHORIZED: ".concat(i.isUserAuthorized));case 10:console.log("ViewContainer Props2:",e.role),e.areCredentialsValid(),console.log("USER ACTIVE:",e.credentialsActive);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[i.authToken,i.email,i.hasAccessTokenExpired,i.access_token,i.refresh_token,null===(t=i.productItemComponent)||void 0===t?void 0:t.props.image]);var g=function(){var t=Object(u.a)(l.a.mark((function t(r){var n,s,o,u,g,m;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r.preventDefault(),n=r.target.id,t.t0=ae,t.next=6,A();case 6:if(t.t1=t.sent,s=t.t0.getEvaluatedCredentials.call(t.t0,t.t1),d((function(e){return Object(c.a)(Object(c.a)({},e),s)})),console.log("AUTHTOKEN Set to LocalStorage:",i.authToken),console.log("hasAccessTokenExpired",i.hasAccessTokenExpired),!i.hasAccessTokenExpired){t.next=38;break}return t.prev=12,t.next=15,ae.setLocalCredWNewTokens(i.refresh_token,a,i.authToken,i.email,i.hasAccessTokenExpired);case 15:if(!(o=t.sent)){t.next=27;break}return console.log("NEW ACCESS TOKENS HAVE BEEN RECEIVED From Refresh;  newUserCredentials:",o),t.t2=ae,t.next=21,A();case 21:t.t3=t.sent,u=t.t2.getEvaluatedCredentials.call(t.t2,t.t3),d((function(e){return Object(c.a)(Object(c.a)({},e),u)})),console.log("New AUTHTOKEN after Refresh:",i.authToken),t.next=29;break;case 27:e.setRole("visitor",!0),C();case 29:t.next=38;break;case 31:if(t.prev=31,t.t4=t.catch(12),console.log("err: ",t.t4),401!==(null===(g=t.t4.response)||void 0===g?void 0:g.status)){t.next=38;break}return console.log("401 status received in ProductInsert"),t.next=38,C();case 38:if(console.log("AUTHORIZED?:",i.isUserAuthorized),!i.isUserAuthorized){t.next=45;break}return console.log("EMAIL IN STAGEDBACTION:",i.email),t.next=43,me(n,i.email,null,null,null,"/api/products/product/delete/",i.refresh_token,i.authToken,i.hasAccessTokenExpired,oe);case 43:m=t.sent,d((function(e){return Object(c.a)(Object(c.a)({},e),m)}));case 45:t.next=52;break;case 47:t.prev=47,t.t5=t.catch(0),console.log("ERROR:",t.t5),console.log("User is logged out"),d((function(e){return Object(c.a)(Object(c.a)({},e),{},{message:"User is logged out"})}));case 52:e.history.push("/products");case 53:case"end":return t.stop()}}),t,null,[[0,47],[12,31]])})));return function(e){return t.apply(this,arguments)}}();return Object(v.jsxs)(n.a.Fragment,{children:[e.loggedOut?"":Object(v.jsx)(P,{role:e.role,perform:"products:view",yes:function(){return Object(v.jsx)(v.Fragment,{children:i.productItemComponent})},no:function(){return Object(v.jsx)(v.Fragment,{})}}),Object(v.jsxs)("div",{className:"text-center",children:[e.loggedOut?"":Object(v.jsx)(P,{role:e.role,perform:"products:update",yes:function(){var e,t,a,r;return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(Ve,{id:null===(e=i.productItemComponent)||void 0===e||null===(t=e.props)||void 0===t?void 0:t.id,name:"Update",value:null===(a=i.productItemComponent)||void 0===a||null===(r=a.props)||void 0===r?void 0:r.value,path:"update/",btnName:"Update"})})},no:function(){return Object(v.jsx)(v.Fragment,{})}}),e.loggedOut?"":Object(v.jsx)(P,{role:e.role,perform:"products:delete",yes:function(){var e,t;return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(_e,{btnName:"Delete",btnClickHandler:function(e){return g(e)},id:null===(e=i.productItemComponent)||void 0===e||null===(t=e.props)||void 0===t?void 0:t.id})})},no:function(){return Object(v.jsx)(v.Fragment,{})}})]})]})},Ge=function(e){return Object(v.jsx)("main",{role:"main",className:"form-align flex-shrink-0",children:Object(v.jsx)(b.e,{children:Object(v.jsx)(b.u,{children:Object(v.jsx)(b.c,{size:"12",middle:!0,children:Object(v.jsxs)("form",{children:[Object(v.jsx)("h1",{className:"mt-5",children:"Registration Form"}),Object(v.jsx)("br",{}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)(W,{htmlFor:"regFormGroupEmail",className:"form-control",id:"regFormGroupEmail",name:"email",label:"Email",value:e.email,changeHandler:e.changeHandler}),Object(v.jsx)(W,{htmlFor:"regFormGroupPassword",className:"form-control",id:"regFormGroupPassword",name:"password",label:"Password",value:e.password,changeHandler:e.changeHandler}),Object(v.jsx)("br",{}),Object(v.jsx)(b.u,{children:Object(v.jsxs)(b.c,{children:[Object(v.jsx)("label",{htmlFor:"formGroupPassword"}),Object(v.jsx)(b.b,{className:"mx-0",color:"blue-grey",onClick:e.clickHandler,children:"Submit"}),Object(v.jsx)("h3",{className:"mt-5",children:e.message?e.message:""})]})})]})]})})})})})},We=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(d.a)(this,a),(r=t.call(this,e)).state=void 0,r.state={email:"",password:"",message:"",existingUserError:"Request failed with status code 409",existingUserMsg:"User exists"},r.changeHandler=r.changeHandler.bind(Object(m.a)(r)),r.clickHandler=r.clickHandler.bind(Object(m.a)(r)),r}return Object(g.a)(a,[{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_();case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"changeHandler",value:function(e){e.preventDefault();var t=e.target;"regFormGroupEmail"===t.id&&function(e){var t=document.getElementById(e);console.log("target:",t),t.addEventListener("keyup",(function(e){t.value=t.value.replace(/\s/g,"").toLowerCase()}))}("regFormGroupEmail"),"red"===t.style.borderColor&&t.value&&$(t);var a=e.target,r=a.name,n=a.value;r&&"string"===typeof n&&this.setState(Object(q.a)({},r,n))}},{key:"clickHandler",value:function(e){var t=this;if(e.preventDefault(),console.log("User Name: ".concat(this.state.email,", Password: ").concat(this.state.password)),this.state.email&&this.state.password){!function(e){console.log("IN REGISTER CALL"),k.register(e).then((function(e){console.log("regResponse:",e),t.setState({message:e.data.message}),t.props.redirectLogin()})).catch((function(e){console.log("ERROR:",e,"Message:",e.message),e.message===t.state.existingUserError?t.setState({message:t.state.existingUserMsg}):t.setState({message:e.message})}))}({email:this.state.email,password:this.state.password}),this.setState({email:"",password:""})}else Y("regFormGroupEmail","regFormGroupPassword")}},{key:"render",value:function(){return Object(v.jsx)(n.a.Fragment,{children:Object(v.jsx)(Ge,{changeHandler:this.changeHandler,clickHandler:this.clickHandler,email:this.state.email,password:this.state.password,message:this.state.message})})}}]),a}(r.Component),Je=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(){var e;return Object(d.a)(this,a),(e=t.call(this)).state={currentPage:"",name:"",role:"",loading:!1,redirect:!1,loggedOut:!1,credentialsValid:!1,refresh_token:"",authToken:""},e.handlePageClick=e.handlePageClick.bind(Object(m.a)(e)),e.redirectHome=e.redirectHome.bind(Object(m.a)(e)),e.redirectLogin=e.redirectLogin.bind(Object(m.a)(e)),e.getRole=e.getRole.bind(Object(m.a)(e)),e.setRole=e.setRole.bind(Object(m.a)(e)),e.areCredentialsValid=e.areCredentialsValid.bind(Object(m.a)(e)),e}return Object(g.a)(a,[{key:"componentDidMount",value:function(){this.getRole(),this.areCredentialsValid()}},{key:"setRole",value:function(e,t){this.setState({role:e,loggedOut:t})}},{key:"areCredentialsValid",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S();case 2:return t=e.sent,a=!t,this.setState({credentialsValid:a}),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRole",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,r,n,s,o=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:return t=e.sent,console.log("APPJS. LOCALSTATEOBJ:",t),a="Bearer "+t.access_token,console.log("APP.js authToken: ".concat(a)),r=t.refresh_token,console.log("APP.js refresh_Token: ".concat(r)),console.log("EMAIL:",t.email),n=t.email,console.log("Navbar Mount3 Email:",n),this.setState({refresh_token:r,authToken:a,loading:!0}),e.next=14,w(n,this.state.authToken,this.state.refresh_token).then((function(e){return console.log("setUserRole:",e.role),o.setState({role:e.role}),o.setState({loading:!1}),console.log("AFTER WILLMOUNT LOAD user:",o.state.role),console.log("APPJS ROLE B4 Set:",o.state.role),o.setState({role:e.role}),console.log("APPJS STATE ROLE After Set:",o.state.role),e.role}));case 14:return s=e.sent,console.log("APP.JS ROLE:",s),this.setState({role:s,loggedOut:!1}),e.abrupt("return",s);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"redirectHome",value:function(){console.log("Called REDIRECT HOME redirect b4",this.state.redirect),this.setState({redirect:!0,role:"visitor",loggedOut:!0}),console.log("Called REDIRECT HOME redirect after",this.state.redirect),V.push({pathname:"/"})}},{key:"redirectLogin",value:function(){V.push({pathname:"/user/login"})}},{key:"handlePageClick",value:function(){var e=Object(u.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({currentPage:t.target.name,name:t.target.name}),"Logout"===t.target.name&&this.redirectHome();case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){console.log("APPJS JUST UPDATED!")}},{key:"render",value:function(){var e=this;return!0===this.state.loading?Object(v.jsx)(Le,{}):Object(v.jsxs)(f.b,{history:V,children:[Object(v.jsx)(F,{handlePageClick:this.handlePageClick,navItems:this.state.navItems,currentPage:this.state.currentPage,name:this.state.name,role:this.state.role,redirectHome:this.redirectHome,setRole:this.setRole,loggedOut:this.state.loggedOut,redirect:this.state.redirect}),Object(v.jsxs)(f.c,{children:[Object(v.jsx)(f.a,{exact:!0,path:"/",render:function(e){return Object(v.jsx)(z,Object(c.a)({},e))}}),Object(v.jsx)(f.a,{exact:!0,path:"/user/registration",render:function(t){return Object(v.jsx)(We,Object(c.a)(Object(c.a)({},t),{},{redirectLogin:e.redirectLogin}))}}),Object(v.jsx)(f.a,{exact:!0,path:"/user/login",render:function(t){return Object(v.jsx)(K,Object(c.a)(Object(c.a)({},t),{},{getRole:e.getRole,role:e.state.role}))}}),Object(v.jsx)(f.a,{exact:!0,path:"/products/product/update/:product_id",render:function(t){return Object(v.jsx)(Fe,Object(c.a)(Object(c.a)({},t),{},{role:e.state.role,loggedOut:e.state.loggedOut,setRole:e.setRole}))}}),Object(v.jsx)(f.a,{exact:!0,path:"/product/insert",render:function(t){return Object(v.jsx)(Ae,Object(c.a)(Object(c.a)({},t),{},{role:e.state.role,loggedOut:e.state.loggedOut,setRole:e.setRole}))}}),Object(v.jsx)(f.a,{exact:!0,path:"/products/product/:product_id",render:function(t){return Object(v.jsx)(ze,Object(c.a)(Object(c.a)({},t),{},{role:e.state.role,loggedOut:e.state.loggedOut,areCredentialsValid:e.areCredentialsValid,credentialsActive:e.state.credentialsActive,setRole:e.setRole}))}}),Object(v.jsx)(f.a,{exact:!0,path:"/products/",render:function(t){return Object(v.jsx)(He,Object(c.a)(Object(c.a)({},t),{},{role:e.state.role,loggedOut:e.state.loggedOut}))}})]}),Object(v.jsx)(j,{})]})}}]),a}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(130),a(131),a(132);o.a.render(Object(v.jsx)(Je,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},71:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){}},[[133,1,2]]]);
//# sourceMappingURL=main.d2ce9a13.chunk.js.map